import{g as se,a as ae,s as E,_ as y,r as h,u as ie,b as re,j as e,d as oe,e as ne,c as L,J as q,I as je,K as _e,B as v,C as H,v as M,w as z,x,D as be,E as W,F as J,G as Se,L as we}from"./index-a7f63edb.js";import{P as Ce,C as ke}from"./PageContainer-675f3af7.js";import{D as Ie,C as $e}from"./DashboardCard-f2ae1d09.js";import{T as A,F as K,I as N}from"./TextField-b77fbb3c.js";import{I as De,a as ze,b as Ae,c as Me,D as Le,d as Re,e as Te,f as Ee,S as Be}from"./IconTrash-f85898c8.js";import{S as Q,A as V}from"./Select-b14aa09c.js";import{M as T}from"./MenuItem-f96f2b68.js";import{B as U}from"./Button-8b327107.js";import{G as g}from"./Grid-0e663064.js";import{T as f}from"./Typography-a4fc7e05.js";import{C as Pe}from"./Chip-3676b158.js";import{S as We,P as Ne}from"./Stack-d2d7eea8.js";import{c as F}from"./createReactComponent-444d0a70.js";import{I as Ue,D as Fe}from"./IconCalendar-446f3ac7.js";import{a as Oe,I as Ge,T as Y}from"./IconSchool-6ca85478.js";import{L as Xe,I as Z}from"./Menu-a4225575.js";import{a as qe,L as He}from"./ListItemText-8ad3faff.js";import{L as Je}from"./ListItemIcon-258384da.js";import{S as Ke,F as ee}from"./FormControlLabel-b3727f50.js";import"./isMuiElement-e1771b7f.js";import"./useTheme-58f5c9ac.js";import"./ButtonBase-9af2261e.js";function Qe(s){return se("MuiCardActions",s)}ae("MuiCardActions",["root","spacing"]);const Ve=["disableSpacing","className"],Ye=s=>{const{classes:a,disableSpacing:o}=s;return ne({root:["root",!o&&"spacing"]},Qe,a)},Ze=E("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(s,a)=>{const{ownerState:o}=s;return[a.root,!o.disableSpacing&&a.spacing]}})(({ownerState:s})=>y({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(:first-of-type)":{marginLeft:8}})),et=h.forwardRef(function(a,o){const m=ie({props:a,name:"MuiCardActions"}),{disableSpacing:j=!1,className:c}=m,_=re(m,Ve),b=y({},m,{disableSpacing:j}),S=Ye(b);return e.jsx(Ze,y({className:oe(S.root,c),ownerState:b,ref:o},_))}),tt=et;function st(s){return se("MuiSwitch",s)}const at=ae("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),d=at,it=["className","color","edge","size","sx"],rt=s=>{const{classes:a,edge:o,size:m,color:j,checked:c,disabled:_}=s,b={root:["root",o&&`edge${L(o)}`,`size${L(m)}`],switchBase:["switchBase",`color${L(j)}`,c&&"checked",_&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},S=ne(b,st,a);return y({},a,S)},ot=E("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(s,a)=>{const{ownerState:o}=s;return[a.root,o.edge&&a[`edge${L(o.edge)}`],a[`size${L(o.size)}`]]}})(({ownerState:s})=>y({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},s.edge==="start"&&{marginLeft:-8},s.edge==="end"&&{marginRight:-8},s.size==="small"&&{width:40,height:24,padding:7,[`& .${d.thumb}`]:{width:16,height:16},[`& .${d.switchBase}`]:{padding:4,[`&.${d.checked}`]:{transform:"translateX(16px)"}}})),nt=E(Ke,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(s,a)=>{const{ownerState:o}=s;return[a.switchBase,{[`& .${d.input}`]:a.input},o.color!=="default"&&a[`color${L(o.color)}`]]}})(({theme:s})=>({position:"absolute",top:0,left:0,zIndex:1,color:s.vars?s.vars.palette.Switch.defaultColor:`${s.palette.mode==="light"?s.palette.common.white:s.palette.grey[300]}`,transition:s.transitions.create(["left","transform"],{duration:s.transitions.duration.shortest}),[`&.${d.checked}`]:{transform:"translateX(20px)"},[`&.${d.disabled}`]:{color:s.vars?s.vars.palette.Switch.defaultDisabledColor:`${s.palette.mode==="light"?s.palette.grey[100]:s.palette.grey[600]}`},[`&.${d.checked} + .${d.track}`]:{opacity:.5},[`&.${d.disabled} + .${d.track}`]:{opacity:s.vars?s.vars.opacity.switchTrackDisabled:`${s.palette.mode==="light"?.12:.2}`},[`& .${d.input}`]:{left:"-100%",width:"300%"}}),({theme:s,ownerState:a})=>y({"&:hover":{backgroundColor:s.vars?`rgba(${s.vars.palette.action.activeChannel} / ${s.vars.palette.action.hoverOpacity})`:q(s.palette.action.active,s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},a.color!=="default"&&{[`&.${d.checked}`]:{color:(s.vars||s).palette[a.color].main,"&:hover":{backgroundColor:s.vars?`rgba(${s.vars.palette[a.color].mainChannel} / ${s.vars.palette.action.hoverOpacity})`:q(s.palette[a.color].main,s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${d.disabled}`]:{color:s.vars?s.vars.palette.Switch[`${a.color}DisabledColor`]:`${s.palette.mode==="light"?je(s.palette[a.color].main,.62):_e(s.palette[a.color].main,.55)}`}},[`&.${d.checked} + .${d.track}`]:{backgroundColor:(s.vars||s).palette[a.color].main}})),lt=E("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(s,a)=>a.track})(({theme:s})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:s.transitions.create(["opacity","background-color"],{duration:s.transitions.duration.shortest}),backgroundColor:s.vars?s.vars.palette.common.onBackground:`${s.palette.mode==="light"?s.palette.common.black:s.palette.common.white}`,opacity:s.vars?s.vars.opacity.switchTrack:`${s.palette.mode==="light"?.38:.3}`})),ct=E("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(s,a)=>a.thumb})(({theme:s})=>({boxShadow:(s.vars||s).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),dt=h.forwardRef(function(a,o){const m=ie({props:a,name:"MuiSwitch"}),{className:j,color:c="primary",edge:_=!1,size:b="medium",sx:S}=m,I=re(m,it),w=y({},m,{color:c,edge:_,size:b}),C=rt(w),$=e.jsx(ct,{className:C.thumb,ownerState:w});return e.jsxs(ot,{className:oe(C.root,j),sx:S,ownerState:w,children:[e.jsx(nt,y({type:"checkbox",icon:$,checkedIcon:$,ref:o,ownerState:w},I,{classes:y({},C,{root:C.switchBase})})),e.jsx(lt,{className:C.track,ownerState:w})]})}),te=dt;var ut=F("check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]),pt=F("currency-dollar","IconCurrencyDollar",[["path",{d:"M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2",key:"svg-0"}],["path",{d:"M12 3v3m0 12v3",key:"svg-1"}]]),ht=F("world","IconWorld",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M3.6 9h16.8",key:"svg-1"}],["path",{d:"M3.6 15h16.8",key:"svg-2"}],["path",{d:"M11.5 3a17 17 0 0 0 0 18",key:"svg-3"}],["path",{d:"M12.5 3a17 17 0 0 1 0 18",key:"svg-4"}]]);const Ut=()=>{const[s,a]=h.useState([]),[o,m]=h.useState([]),[j,c]=h.useState(!0),[_,b]=h.useState(null),[S,I]=h.useState(!1),[w,C]=h.useState("add"),[$,le]=h.useState(""),[B,ce]=h.useState("all"),[i,R]=h.useState({name:"",description:"",provider:"",amount:"",deadline:"",eligibility:"",university_id:"",is_active:!0,created_at:new Date}),[P,k]=h.useState({open:!1,message:"",severity:"success"});h.useEffect(()=>{(async()=>{try{c(!0);let n=(await M(z(x,"scholarships"))).docs.map(p=>({id:p.id,...p.data(),is_active:p.data().is_active!==void 0?p.data().is_active:!0}));await ge();const l=(await M(z(x,"universities"))).docs.map(p=>({id:p.id,...p.data()}));a(n),m(l),c(!1)}catch(r){console.error("Error fetching data:",r),b("Failed to load data. Please try again."),c(!1)}})()},[]);const de=()=>{R({name:"",description:"",provider:"",amount:"",deadline:"",eligibility:"",university_id:"",is_active:!0,created_at:new Date}),C("add"),I(!0)},ue=t=>{R({id:t.id,name:t.name||"",description:t.criteria?t.criteria.join(`
`):"",provider:t.university_name||"",amount:t.value||"",deadline:t.application_deadline||"",eligibility:t.field_of_study?t.field_of_study.join(", "):"",university_id:t.university_id||"",is_active:t.is_active!==void 0?t.is_active:!0,created_at:t.created_at||new Date,original_criteria:t.criteria||[],original_type:t.type||[],original_applicable_course_levels:t.applicable_course_levels||[],original_field_of_study:t.field_of_study||[],original_location:t.location||[],original_awards_details:t.awards_details||{}}),C("edit"),I(!0)},D=t=>{const{name:r,value:n}=t.target;R(r==="amount"?{...i,[r]:n===""?"":parseFloat(n)}:{...i,[r]:n})},pe=t=>{R({...i,is_active:t.target.checked})},he=async()=>{try{c(!0);let t="";if(i.university_id){const l=o.find(p=>p.id===i.university_id);l&&(t=l.name)}const r={name:i.name,university_id:i.university_id,university_name:t,criteria:i.description?i.description.split(`
`).filter(l=>l.trim()!==""):[],value:i.amount,application_deadline:i.deadline,is_active:i.is_active,updated_at:new Date,type:i.original_type||[],applicable_course_levels:i.original_applicable_course_levels||[],field_of_study:i.original_field_of_study||[],location:i.original_location||[],awards_details:i.original_awards_details||{}};if(w==="add")await be(z(x,"scholarships"),r),k({open:!0,message:"Scholarship added successfully!",severity:"success"});else{const l=W(x,"scholarships",i.id),{id:p,original_criteria:X,original_type:mt,original_applicable_course_levels:gt,original_field_of_study:vt,original_location:xt,original_awards_details:ft,...ye}=r;await J(l,ye,{merge:!0}),k({open:!0,message:"Scholarship updated successfully!",severity:"success"})}I(!1);const u=(await M(z(x,"scholarships"))).docs.map(l=>({id:l.id,...l.data()}));a(u)}catch(t){console.error("Error saving scholarship:",t),k({open:!0,message:`Error: ${t.message}`,severity:"error"})}finally{c(!1)}},me=async t=>{if(window.confirm("Are you sure you want to delete this scholarship?"))try{c(!0),await Se(W(x,"scholarships",t)),k({open:!0,message:"Scholarship deleted successfully!",severity:"success"});const n=(await M(z(x,"scholarships"))).docs.map(u=>({id:u.id,...u.data()}));a(n)}catch(r){console.error("Error deleting scholarship:",r),k({open:!0,message:`Error: ${r.message}`,severity:"error"})}finally{c(!1)}},ge=async()=>{try{const t=await M(z(x,"scholarships")),r=we(x);let n=0;t.docs.forEach(u=>{u.data().is_active===void 0&&(console.log(`Setting is_active=true for scholarship: ${u.id}`),r.update(u.ref,{is_active:!0}),n++)}),n>0?(await r.commit(),console.log(`Updated is_active field for ${n} scholarships`)):console.log("All scholarships already have is_active field")}catch(t){console.error("Error initializing active status:",t)}},ve=async t=>{try{c(!0);const r=W(x,"scholarships",t.id);await J(r,{is_active:!t.is_active,updated_at:new Date},{merge:!0});const u=(await M(z(x,"scholarships"))).docs.map(l=>({id:l.id,...l.data()}));a(u),k({open:!0,message:`Scholarship ${t.is_active?"deactivated":"activated"} successfully!`,severity:"success"})}catch(r){console.error("Error toggling scholarship status:",r),k({open:!0,message:`Error: ${r.message}`,severity:"error"})}finally{c(!1)}},O=()=>{k({...P,open:!1})},G=s.filter(t=>{var u,l,p;const r=((u=t.name)==null?void 0:u.toLowerCase().includes($.toLowerCase()))||((l=t.criteria)==null?void 0:l.some(X=>X.toLowerCase().includes($.toLowerCase())))||((p=t.university_name)==null?void 0:p.toLowerCase().includes($.toLowerCase())),n=B==="all"||B==="active"&&t.is_active||B==="inactive"&&!t.is_active;return r&&n}),xe=t=>{if(!t)return"No deadline";try{return t._seconds?new Date(t._seconds*1e3).toLocaleDateString():new Date(t).toLocaleDateString()}catch{return t}},fe=t=>t?"success":"error";return e.jsx(Ce,{title:"Scholarship Management",description:"Manage all scholarships",children:e.jsxs(Ie,{title:"Scholarships",children:[e.jsxs(v,{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(v,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(A,{size:"small",placeholder:"Search scholarships...",value:$,onChange:t=>le(t.target.value),sx:{width:300},InputProps:{startAdornment:e.jsx(De,{size:"20",style:{marginRight:"8px"}})}}),e.jsxs(K,{size:"small",sx:{minWidth:120},children:[e.jsx(N,{id:"status-filter-label",children:"Status"}),e.jsxs(Q,{labelId:"status-filter-label",value:B,label:"Status",onChange:t=>ce(t.target.value),children:[e.jsx(T,{value:"all",children:"All Status"}),e.jsx(T,{value:"active",children:"Active"}),e.jsx(T,{value:"inactive",children:"Inactive"})]})]})]}),e.jsx(U,{variant:"contained",color:"primary",startIcon:e.jsx(ze,{size:"18"}),onClick:de,children:"Add Scholarship"})]}),j&&!S?e.jsx(v,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:e.jsx(H,{})}):_?e.jsx(V,{severity:"error",children:_}):e.jsx(g,{container:!0,spacing:3,children:G.length>0?G.map(t=>e.jsx(g,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ke,{sx:{height:"100%",display:"flex",flexDirection:"column",borderTop:"4px solid",borderColor:t.is_active?"success.main":"error.main"},children:[e.jsxs($e,{sx:{flexGrow:1},children:[e.jsxs(v,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:t.name}),e.jsx(Pe,{label:t.is_active?"Active":"Inactive",size:"small",color:fe(t.is_active)})]}),e.jsxs(We,{spacing:2,children:[e.jsxs(v,{display:"flex",alignItems:"center",children:[e.jsx(ht,{size:"20",style:{marginRight:"8px"}}),e.jsxs(f,{variant:"body2",children:[e.jsx("b",{children:"University:"})," ",t.university_name||"Any university"]})]}),e.jsxs(v,{display:"flex",alignItems:"center",children:[e.jsx(pt,{size:"20",style:{marginRight:"8px"}}),e.jsxs(f,{variant:"body2",children:[e.jsx("b",{children:"Amount:"})," ",t.value?`RM ${t.value}`:"Not specified"]})]}),e.jsxs(v,{display:"flex",alignItems:"center",children:[e.jsx(Ue,{size:"20",style:{marginRight:"8px"}}),e.jsxs(f,{variant:"body2",children:[e.jsx("b",{children:"Deadline:"})," ",xe(t.application_deadline)]})]}),t.applicable_course_levels&&t.applicable_course_levels.length>0&&e.jsxs(v,{display:"flex",alignItems:"flex-start",children:[e.jsx(Oe,{size:"20",style:{marginRight:"8px",marginTop:"3px"}}),e.jsxs(f,{variant:"body2",children:[e.jsx("b",{children:"Applicable for:"})," ",t.applicable_course_levels.join(", ")]})]}),t.field_of_study&&t.field_of_study.length>0&&e.jsxs(v,{display:"flex",alignItems:"flex-start",children:[e.jsx(Ge,{size:"20",style:{marginRight:"8px",marginTop:"3px"}}),e.jsxs(f,{variant:"body2",children:[e.jsx("b",{children:"Field of Study:"})," ",t.field_of_study.join(", ")]})]}),t.criteria&&t.criteria.length>0&&e.jsxs(v,{mt:1,children:[e.jsx(f,{variant:"subtitle2",gutterBottom:!0,children:"Eligibility Criteria:"}),e.jsx(Xe,{dense:!0,disablePadding:!0,children:t.criteria.map((r,n)=>e.jsxs(qe,{disablePadding:!0,sx:{mt:.5},children:[e.jsx(Je,{sx:{minWidth:24},children:e.jsx(ut,{size:"16"})}),e.jsx(He,{primary:r,primaryTypographyProps:{variant:"body2",style:{margin:0}}})]},n))})]})]})]}),e.jsx(Fe,{}),e.jsxs(tt,{sx:{justifyContent:"space-between",p:2},children:[e.jsx(ee,{control:e.jsx(te,{size:"small",checked:t.is_active,onChange:()=>ve(t),color:"success"}),label:e.jsx(f,{variant:"caption",children:t.is_active?"Active":"Inactive"})}),e.jsxs(v,{children:[e.jsx(Y,{title:"Edit",children:e.jsx(Z,{color:"primary",size:"small",onClick:()=>ue(t),children:e.jsx(Ae,{size:"18"})})}),e.jsx(Y,{title:"Delete",children:e.jsx(Z,{color:"error",size:"small",onClick:()=>me(t.id),children:e.jsx(Me,{size:"18"})})})]})]})]})},t.id)):e.jsx(g,{item:!0,xs:12,children:e.jsx(Ne,{sx:{p:3,textAlign:"center"},children:e.jsx(f,{variant:"body1",color:"textSecondary",children:"No scholarships found. Add a new scholarship to get started."})})})}),e.jsxs(Le,{open:S,onClose:()=>I(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(Re,{children:w==="add"?"Add New Scholarship":"Edit Scholarship"}),e.jsx(Te,{children:e.jsxs(g,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(g,{item:!0,xs:12,sm:8,children:e.jsx(A,{fullWidth:!0,label:"Scholarship Name",name:"name",value:i.name,onChange:D,required:!0})}),e.jsx(g,{item:!0,xs:12,sm:4,children:e.jsx(ee,{control:e.jsx(te,{checked:i.is_active,onChange:pe,color:"success"}),label:"Active Status"})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(A,{fullWidth:!0,label:"Criteria (one per line)",name:"description",value:i.description,onChange:D,multiline:!0,rows:3,placeholder:"Enter each criterion on a new line",helperText:"Each line will be shown as a separate criterion point"})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsx(A,{fullWidth:!0,label:"Provider",name:"provider",value:i.provider,onChange:D,placeholder:"e.g. Ministry of Education"})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsxs(K,{fullWidth:!0,children:[e.jsx(N,{id:"university-label",children:"University"}),e.jsxs(Q,{labelId:"university-label",name:"university_id",value:i.university_id,label:"University",onChange:D,children:[e.jsx(T,{value:"",children:"Any University"}),o.map(t=>e.jsx(T,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsx(A,{fullWidth:!0,label:"Amount (RM)",name:"amount",value:i.amount,onChange:D,type:"number",InputProps:{startAdornment:e.jsx(N,{})}})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsx(A,{fullWidth:!0,label:"Deadline",name:"deadline",value:i.deadline,onChange:D,type:"date",InputLabelProps:{shrink:!0}})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(A,{fullWidth:!0,label:"Field of Study (comma separated)",name:"eligibility",value:i.eligibility,onChange:D,placeholder:"e.g. Engineering, Computer Science, Business",helperText:"Separate different fields with commas"})})]})}),e.jsxs(Ee,{children:[e.jsx(U,{onClick:()=>I(!1),children:"Cancel"}),e.jsx(U,{onClick:he,variant:"contained",color:"primary",disabled:!i.name,children:j?e.jsx(H,{size:24}):"Save"})]})]}),e.jsx(Be,{open:P.open,autoHideDuration:6e3,onClose:O,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(V,{onClose:O,severity:P.severity,variant:"filled",children:P.message})})]})})};export{Ut as default};
