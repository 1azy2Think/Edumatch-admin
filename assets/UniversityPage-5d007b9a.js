import{r as d,v as A,w as T,x as f,j as e,B as C,C as R,D as se,E as G,F as te,G as re}from"./index-c2563e0d.js";import{P as ae}from"./PageContainer-aad2cfc7.js";import{D as ie}from"./DashboardCard-ebe6ddff.js";import{T as b}from"./TextField-32d44c51.js";import{I as ne,a as oe,b as le,c as ce,D as de,d as ue,e as he,f as me,S as xe}from"./IconTrash-27718a5b.js";import{B as P}from"./Button-bbfd11bb.js";import{A as K}from"./Select-5e0a2fa0.js";import{T as pe}from"./TableContainer-ba397d3b.js";import{P as fe}from"./Stack-e027e86c.js";import{T as je,a as ge,b as z,c as i,d as Ce}from"./TableRow-335db815.js";import{T as m}from"./Typography-ebb123db.js";import{C as D}from"./Chip-a1a18a82.js";import{I as q}from"./Menu-69da4fd0.js";import{G as j}from"./Grid-fa4dfe26.js";import"./isMuiElement-2e8354c0.js";import"./useTheme-338ae4be.js";import"./ButtonBase-bf72575c.js";import"./createReactComponent-0c7df6dc.js";const _e=()=>{const[H,O]=d.useState([]),[W,u]=d.useState(!0),[L,$]=d.useState(null),[N,g]=d.useState(!1),[B,_]=d.useState("add"),[I,J]=d.useState(""),[r,y]=d.useState({name:"",state:"",address:"",website:"",coursesCount:0,scholarshipsCount:0}),[v,x]=d.useState({open:!1,message:"",severity:"success"}),U=s=>{if(!s)return"";const t=s.split(",").map(l=>l.trim()),n=["Selangor","Kuala Lumpur","Penang","Johor","Perak","Sabah","Sarawak","Melaka","Negeri Sembilan","Kedah","Pahang","Terengganu","Kelantan","Perlis","Labuan","Putrajaya"];for(const l of t)for(const h of n)if(l.includes(h))return h;return t.length>=2?t[t.length-2]:""};d.useEffect(()=>{E()},[]);const E=async()=>{try{u(!0);const s=await A(T(f,"universities")),t=await A(T(f,"courses")),n=await A(T(f,"scholarships")),l={},h={};t.docs.forEach(c=>{const a=c.data().university_id;a&&(l[a]=(l[a]||0)+1)}),n.docs.forEach(c=>{const a=c.data().university_id;a&&(h[a]=(h[a]||0)+1)});const p=s.docs.map(c=>{const o=c.data();let a="",k="";o.location&&o.location.address?(a=o.location.address,k=U(a)):o.contact_info&&o.contact_info.address&&(a=o.contact_info.address,k=U(a));const Z=l[c.id]||o.coursesCount||0,ee=h[c.id]||o.scholarshipsCount||0;return{id:c.id,...o,address:a,state:k,coursesCount:Z,scholarshipsCount:ee}});O(p),u(!1)}catch(s){console.error("Error fetching universities:",s),$("Failed to load universities. Please try again."),u(!1)}},V=()=>{y({name:"",state:"",address:"",website:"",coursesCount:0,scholarshipsCount:0}),_("add"),g(!0)},Q=s=>{y({id:s.id,name:s.name||"",state:s.state||"",address:s.address||"",website:s.website||"",coursesCount:s.coursesCount||0,scholarshipsCount:s.scholarshipsCount||0}),_("edit"),g(!0)},w=s=>{const{name:t,value:n}=s.target;if(t==="address"){const l=U(n);y({...r,address:n,state:l})}else y({...r,[t]:n})},X=async()=>{var s;try{u(!0);const{id:t,state:n,coursesCount:l,scholarshipsCount:h,...p}=r;if(r.address&&(p.location={address:r.address,coordinates:((s=p.location)==null?void 0:s.coordinates)||{lat:0,lng:0}}),B==="add")await se(T(f,"universities"),p),x({open:!0,message:"University added successfully!",severity:"success"});else{const c=G(f,"universities",t);await te(c,p,{merge:!0}),x({open:!0,message:"University updated successfully!",severity:"success"})}g(!1),E()}catch(t){console.error("Error saving university:",t),x({open:!0,message:`Error: ${t.message}`,severity:"error"})}finally{u(!1)}},Y=async s=>{if(window.confirm("Are you sure you want to delete this university?"))try{u(!0),await re(G(f,"universities",s)),x({open:!0,message:"University deleted successfully!",severity:"success"}),E()}catch(t){console.error("Error deleting university:",t),x({open:!0,message:`Error: ${t.message}`,severity:"error"})}finally{u(!1)}},M=()=>{x({...v,open:!1})},F=H.filter(s=>{var t,n;return((t=s.name)==null?void 0:t.toLowerCase().includes(I.toLowerCase()))||((n=s.state)==null?void 0:n.toLowerCase().includes(I.toLowerCase()))}),S=s=>s>=10?"success":s>=5?"primary":s>=1?"info":"default";return e.jsxs(ae,{title:"University Management",description:"Manage all universities",children:[e.jsxs(ie,{title:"Universities",children:[e.jsxs(C,{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(C,{display:"flex",alignItems:"center",children:e.jsx(b,{size:"small",placeholder:"Search universities...",value:I,onChange:s=>J(s.target.value),sx:{width:300},InputProps:{startAdornment:e.jsx(ne,{size:"20",style:{marginRight:"8px"}})}})}),e.jsx(P,{variant:"contained",color:"primary",startIcon:e.jsx(oe,{size:"18"}),onClick:V,children:"Add University"})]}),W&&!N?e.jsx(C,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:e.jsx(R,{})}):L?e.jsx(K,{severity:"error",children:L}):e.jsx(pe,{component:fe,sx:{boxShadow:"none"},children:e.jsxs(je,{sx:{minWidth:650},"aria-label":"universities table",children:[e.jsx(ge,{children:e.jsxs(z,{children:[e.jsx(i,{children:"University Name"}),e.jsx(i,{children:"State"}),e.jsx(i,{children:"Courses"}),e.jsx(i,{children:"Scholarships"}),e.jsx(i,{children:"Website"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(Ce,{children:F.length>0?F.map(s=>e.jsxs(z,{children:[e.jsx(i,{children:e.jsx(m,{variant:"subtitle2",fontWeight:600,children:s.name})}),e.jsx(i,{children:s.state||"N/A"}),e.jsx(i,{children:e.jsx(D,{label:s.coursesCount||"0",size:"small",color:S(s.coursesCount)})}),e.jsx(i,{children:e.jsx(D,{label:s.scholarshipsCount||"0",size:"small",color:S(s.scholarshipsCount)})}),e.jsx(i,{children:s.website?e.jsx(m,{variant:"body2",sx:{textDecoration:"underline",color:"primary.main",cursor:"pointer"},onClick:()=>window.open(s.website,"_blank"),children:"Visit Website"}):"N/A"}),e.jsxs(i,{children:[e.jsx(q,{color:"primary",size:"small",onClick:()=>Q(s),children:e.jsx(le,{size:"18"})}),e.jsx(q,{color:"error",size:"small",onClick:()=>Y(s.id),children:e.jsx(ce,{size:"18"})})]})]},s.id)):e.jsx(z,{children:e.jsx(i,{colSpan:6,align:"center",children:e.jsx(m,{variant:"body2",color:"textSecondary",py:2,children:"No universities found."})})})})]})})]}),e.jsxs(de,{open:N,onClose:()=>g(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(ue,{children:B==="add"?"Add New University":"Edit University"}),e.jsx(he,{children:e.jsxs(j,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,label:"University Name",name:"name",value:r.name,onChange:w,required:!0})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,label:"Address",name:"address",value:r.address,onChange:w,required:!0,helperText:"State will be automatically extracted from address"})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,label:"State",name:"state",value:r.state,onChange:w,disabled:!0,helperText:"Auto-detected from address"})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,label:"Website",name:"website",value:r.website,onChange:w,placeholder:"e.g. https://www.university.edu"})}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(m,{variant:"subtitle2",sx:{mt:2,mb:1},children:"Course & Scholarship Counts"}),e.jsx(m,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"These counts will be automatically updated when courses and scholarships are added or removed."}),e.jsxs(C,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(m,{variant:"body2",sx:{width:120},children:"Courses:"}),e.jsx(D,{label:r.coursesCount||"0",size:"small",color:S(r.coursesCount),sx:{mr:1}})]}),e.jsxs(C,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(m,{variant:"body2",sx:{width:120},children:"Scholarships:"}),e.jsx(D,{label:r.scholarshipsCount||"0",size:"small",color:S(r.scholarshipsCount)})]})]})]})}),e.jsxs(me,{children:[e.jsx(P,{onClick:()=>g(!1),children:"Cancel"}),e.jsx(P,{onClick:X,variant:"contained",color:"primary",disabled:!r.name||!r.address,children:W?e.jsx(R,{size:24}):"Save"})]})]}),e.jsx(xe,{open:v.open,autoHideDuration:6e3,onClose:M,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(K,{onClose:M,severity:v.severity,variant:"filled",children:v.message})})]})};export{_e as default};
