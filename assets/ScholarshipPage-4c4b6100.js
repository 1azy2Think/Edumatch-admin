import{g as ue,a as pe,s as E,_ as C,r as h,u as he,b as me,j as e,d as ve,e as ge,c as z,I as ee,J as Ae,K as ze,k as Me,l as Re,v as A,w as D,x,L as Le,B as v,T as f,C as te,D as Te,E as G,F as se,G as Ee}from"./index-e237ffcb.js";import{P as ae,C as Be}from"./PageContainer-438f08df.js";import{D as Pe,C as Ne}from"./DashboardCard-9af2fd3c.js";import{B as F}from"./Button-94b6ad7b.js";import{T as $,F as ie,I as q}from"./TextField-bc453406.js";import{I as We,a as Ue,b as Fe,c as Oe,D as Ye,d as Ge,e as qe,f as Xe,S as He}from"./IconTrash-30b94cb9.js";import{S as re,A as oe}from"./Select-c72bd6b3.js";import{M as T}from"./MenuItem-aa6690b8.js";import{G as g}from"./Grid-2fad7a3e.js";import{C as Je}from"./Chip-dec8f5a0.js";import{S as Ke,P as Ve}from"./Stack-ad5be72a.js";import{c as X}from"./createReactComponent-1617f643.js";import{I as Qe,D as Ze}from"./IconCalendar-14c29fba.js";import{I as et}from"./IconSchool-f5abe1e2.js";import{I as tt}from"./IconBookmark-3cf1df47.js";import{L as st,I as ne}from"./Menu-34ff1fc5.js";import{a as at,L as it}from"./ListItemText-83e09eeb.js";import{L as rt}from"./ListItemIcon-6a7a02ba.js";import{S as ot,F as le}from"./FormControlLabel-bcd6d999.js";import{T as ce}from"./Tooltip-f262598b.js";import"./ButtonBase-284552f5.js";import"./isMuiElement-2994e265.js";import"./useTheme-72ab8b2f.js";import"./styled-3af17cfc.js";function nt(s){return ue("MuiCardActions",s)}pe("MuiCardActions",["root","spacing"]);const lt=["disableSpacing","className"],ct=s=>{const{classes:a,disableSpacing:n}=s;return ge({root:["root",!n&&"spacing"]},nt,a)},dt=E("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(s,a)=>{const{ownerState:n}=s;return[a.root,!n.disableSpacing&&a.spacing]}})(({ownerState:s})=>C({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(:first-of-type)":{marginLeft:8}})),ut=h.forwardRef(function(a,n){const p=he({props:a,name:"MuiCardActions"}),{disableSpacing:b=!1,className:w}=p,y=me(p,lt),_=C({},p,{disableSpacing:b}),k=ct(_);return e.jsx(dt,C({className:ve(k.root,w),ownerState:_,ref:n},y))}),pt=ut;function ht(s){return ue("MuiSwitch",s)}const mt=pe("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),u=mt,vt=["className","color","edge","size","sx"],gt=s=>{const{classes:a,edge:n,size:p,color:b,checked:w,disabled:y}=s,_={root:["root",n&&`edge${z(n)}`,`size${z(p)}`],switchBase:["switchBase",`color${z(b)}`,w&&"checked",y&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},k=ge(_,ht,a);return C({},a,k)},xt=E("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(s,a)=>{const{ownerState:n}=s;return[a.root,n.edge&&a[`edge${z(n.edge)}`],a[`size${z(n.size)}`]]}})(({ownerState:s})=>C({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},s.edge==="start"&&{marginLeft:-8},s.edge==="end"&&{marginRight:-8},s.size==="small"&&{width:40,height:24,padding:7,[`& .${u.thumb}`]:{width:16,height:16},[`& .${u.switchBase}`]:{padding:4,[`&.${u.checked}`]:{transform:"translateX(16px)"}}})),ft=E(ot,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(s,a)=>{const{ownerState:n}=s;return[a.switchBase,{[`& .${u.input}`]:a.input},n.color!=="default"&&a[`color${z(n.color)}`]]}})(({theme:s})=>({position:"absolute",top:0,left:0,zIndex:1,color:s.vars?s.vars.palette.Switch.defaultColor:`${s.palette.mode==="light"?s.palette.common.white:s.palette.grey[300]}`,transition:s.transitions.create(["left","transform"],{duration:s.transitions.duration.shortest}),[`&.${u.checked}`]:{transform:"translateX(20px)"},[`&.${u.disabled}`]:{color:s.vars?s.vars.palette.Switch.defaultDisabledColor:`${s.palette.mode==="light"?s.palette.grey[100]:s.palette.grey[600]}`},[`&.${u.checked} + .${u.track}`]:{opacity:.5},[`&.${u.disabled} + .${u.track}`]:{opacity:s.vars?s.vars.opacity.switchTrackDisabled:`${s.palette.mode==="light"?.12:.2}`},[`& .${u.input}`]:{left:"-100%",width:"300%"}}),({theme:s,ownerState:a})=>C({"&:hover":{backgroundColor:s.vars?`rgba(${s.vars.palette.action.activeChannel} / ${s.vars.palette.action.hoverOpacity})`:ee(s.palette.action.active,s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},a.color!=="default"&&{[`&.${u.checked}`]:{color:(s.vars||s).palette[a.color].main,"&:hover":{backgroundColor:s.vars?`rgba(${s.vars.palette[a.color].mainChannel} / ${s.vars.palette.action.hoverOpacity})`:ee(s.palette[a.color].main,s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${u.disabled}`]:{color:s.vars?s.vars.palette.Switch[`${a.color}DisabledColor`]:`${s.palette.mode==="light"?Ae(s.palette[a.color].main,.62):ze(s.palette[a.color].main,.55)}`}},[`&.${u.checked} + .${u.track}`]:{backgroundColor:(s.vars||s).palette[a.color].main}})),yt=E("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(s,a)=>a.track})(({theme:s})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:s.transitions.create(["opacity","background-color"],{duration:s.transitions.duration.shortest}),backgroundColor:s.vars?s.vars.palette.common.onBackground:`${s.palette.mode==="light"?s.palette.common.black:s.palette.common.white}`,opacity:s.vars?s.vars.opacity.switchTrack:`${s.palette.mode==="light"?.38:.3}`})),jt=E("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(s,a)=>a.thumb})(({theme:s})=>({boxShadow:(s.vars||s).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),bt=h.forwardRef(function(a,n){const p=he({props:a,name:"MuiSwitch"}),{className:b,color:w="primary",edge:y=!1,size:_="medium",sx:k}=p,B=me(p,vt),c=C({},p,{color:w,edge:y,size:_}),S=gt(c),P=e.jsx(jt,{className:S.thumb,ownerState:c});return e.jsxs(xt,{className:ve(S.root,b),sx:k,ownerState:c,children:[e.jsx(ft,C({type:"checkbox",icon:P,checkedIcon:P,ref:n,ownerState:c},B,{classes:C({},S,{root:S.switchBase})})),e.jsx(yt,{className:S.track,ownerState:c})]})}),de=bt;var _t=X("check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]),Ct=X("currency-dollar","IconCurrencyDollar",[["path",{d:"M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2",key:"svg-0"}],["path",{d:"M12 3v3m0 12v3",key:"svg-1"}]]),St=X("world","IconWorld",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M3.6 9h16.8",key:"svg-1"}],["path",{d:"M3.6 15h16.8",key:"svg-2"}],["path",{d:"M11.5 3a17 17 0 0 0 0 18",key:"svg-3"}],["path",{d:"M12.5 3a17 17 0 0 1 0 18",key:"svg-4"}]]);const es=()=>{const{currentUser:s,userRole:a,isAdmin:n,hasRole:p}=Me(),b=Re(),[w,y]=h.useState([]),[_,k]=h.useState([]),[B,c]=h.useState(!0),[S,P]=h.useState(null),[H,M]=h.useState(!1),[J,K]=h.useState("add"),[N,xe]=h.useState(""),[W,fe]=h.useState("all"),[i,R]=h.useState({name:"",description:"",provider:"",amount:"",deadline:"",eligibility:"",university_id:"",is_active:!0,created_at:new Date}),[U,m]=h.useState({open:!1,message:"",severity:"success"}),O=()=>!!a,j=()=>n()||p("moderator")||p("editor"),Y=()=>n()||p("moderator");h.useEffect(()=>{a!==null&&!O()&&b("/dashboard")},[a,b]),h.useEffect(()=>{O()&&ye()},[a]);const ye=async()=>{try{c(!0);let r=(await A(D(x,"scholarships"))).docs.map(o=>({id:o.id,...o.data(),is_active:o.data().is_active!==void 0?o.data().is_active:!0}));await we();const d=(await A(D(x,"universities"))).docs.map(o=>({id:o.id,...o.data()}));y(r),k(d),c(!1)}catch(t){console.error("Error fetching data:",t),P("Failed to load data. Please try again."),c(!1)}},je=()=>{if(!j()){m({open:!0,message:"You do not have permission to add scholarships",severity:"error"});return}R({name:"",description:"",provider:"",amount:"",deadline:"",eligibility:"",university_id:"",is_active:!0,created_at:new Date}),K("add"),M(!0)},be=t=>{if(!j()){m({open:!0,message:"You do not have permission to edit scholarships",severity:"error"});return}R({id:t.id,name:t.name||"",description:t.criteria?t.criteria.join(`
`):"",provider:t.university_name||"",amount:t.value||"",deadline:t.application_deadline||"",eligibility:t.field_of_study?t.field_of_study.join(", "):"",university_id:t.university_id||"",is_active:t.is_active!==void 0?t.is_active:!0,created_at:t.created_at||new Date,original_criteria:t.criteria||[],original_type:t.type||[],original_applicable_course_levels:t.applicable_course_levels||[],original_field_of_study:t.field_of_study||[],original_location:t.location||[],original_awards_details:t.awards_details||{}}),K("edit"),M(!0)},I=t=>{const{name:r,value:l}=t.target;R(r==="amount"?{...i,[r]:l===""?"":parseFloat(l)}:{...i,[r]:l})},_e=t=>{R({...i,is_active:t.target.checked})},Ce=async()=>{if(!j()){m({open:!0,message:"You do not have permission to manage scholarships",severity:"error"});return}try{c(!0);let t="";if(i.university_id){const o=_.find(L=>L.id===i.university_id);o&&(t=o.name)}const r={name:i.name,university_id:i.university_id,university_name:t,criteria:i.description?i.description.split(`
`).filter(o=>o.trim()!==""):[],value:i.amount,application_deadline:i.deadline,is_active:i.is_active,updated_at:new Date,type:i.original_type||[],applicable_course_levels:i.original_applicable_course_levels||[],field_of_study:i.original_field_of_study||[],location:i.original_location||[],awards_details:i.original_awards_details||{}};if(J==="add")await Te(D(x,"scholarships"),r),m({open:!0,message:"Scholarship added successfully!",severity:"success"});else{const o=G(x,"scholarships",i.id),{id:L,original_criteria:Z,original_type:wt,original_applicable_course_levels:kt,original_field_of_study:It,original_location:Dt,original_awards_details:$t,...$e}=r;await se(o,$e,{merge:!0}),m({open:!0,message:"Scholarship updated successfully!",severity:"success"})}M(!1);const d=(await A(D(x,"scholarships"))).docs.map(o=>({id:o.id,...o.data()}));y(d)}catch(t){console.error("Error saving scholarship:",t),m({open:!0,message:`Error: ${t.message}`,severity:"error"})}finally{c(!1)}},Se=async t=>{if(!j()){m({open:!0,message:"You do not have permission to delete scholarships",severity:"error"});return}if(window.confirm("Are you sure you want to delete this scholarship?"))try{c(!0),await Ee(G(x,"scholarships",t)),m({open:!0,message:"Scholarship deleted successfully!",severity:"success"});const l=(await A(D(x,"scholarships"))).docs.map(d=>({id:d.id,...d.data()}));y(l)}catch(r){console.error("Error deleting scholarship:",r),m({open:!0,message:`Error: ${r.message}`,severity:"error"})}finally{c(!1)}},we=async()=>{try{const t=await A(D(x,"scholarships")),r=Le(x);let l=0;t.docs.forEach(d=>{d.data().is_active===void 0&&(console.log(`Setting is_active=true for scholarship: ${d.id}`),r.update(d.ref,{is_active:!0}),l++)}),l>0?(await r.commit(),console.log(`Updated is_active field for ${l} scholarships`)):console.log("All scholarships already have is_active field")}catch(t){console.error("Error initializing active status:",t)}},ke=async t=>{if(!Y()&&!j()){m({open:!0,message:"You do not have permission to activate/deactivate scholarships",severity:"error"});return}try{c(!0);const r=G(x,"scholarships",t.id);await se(r,{is_active:!t.is_active,updated_at:new Date},{merge:!0});const d=(await A(D(x,"scholarships"))).docs.map(o=>({id:o.id,...o.data()}));y(d),m({open:!0,message:`Scholarship ${t.is_active?"deactivated":"activated"} successfully!`,severity:"success"})}catch(r){console.error("Error toggling scholarship status:",r),m({open:!0,message:`Error: ${r.message}`,severity:"error"})}finally{c(!1)}},V=()=>{m({...U,open:!1})},Q=w.filter(t=>{var d,o,L;const r=((d=t.name)==null?void 0:d.toLowerCase().includes(N.toLowerCase()))||((o=t.criteria)==null?void 0:o.some(Z=>Z.toLowerCase().includes(N.toLowerCase())))||((L=t.university_name)==null?void 0:L.toLowerCase().includes(N.toLowerCase())),l=W==="all"||W==="active"&&t.is_active||W==="inactive"&&!t.is_active;return r&&l}),Ie=t=>{if(!t)return"No deadline";try{return t._seconds?new Date(t._seconds*1e3).toLocaleDateString():new Date(t).toLocaleDateString()}catch{return t}},De=t=>t?"success":"error";return a!==null&&!O()?e.jsx(ae,{title:"Access Denied",description:"Permission required",children:e.jsxs(v,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"80vh",children:[e.jsx(f,{variant:"h4",color:"error",gutterBottom:!0,children:"Access Denied"}),e.jsx(f,{variant:"body1",children:"You don't have permission to access this page."}),e.jsx(F,{variant:"contained",color:"primary",sx:{mt:3},onClick:()=>b("/dashboard"),children:"Go to Dashboard"})]})}):e.jsx(ae,{title:"Scholarship Management",description:"Manage all scholarships",children:e.jsxs(Pe,{title:"Scholarships",children:[e.jsxs(v,{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(v,{display:"flex",alignItems:"center",gap:2,children:[e.jsx($,{size:"small",placeholder:"Search scholarships...",value:N,onChange:t=>xe(t.target.value),sx:{width:300},InputProps:{startAdornment:e.jsx(We,{size:"20",style:{marginRight:"8px"}})}}),e.jsxs(ie,{size:"small",sx:{minWidth:120},children:[e.jsx(q,{id:"status-filter-label",children:"Status"}),e.jsxs(re,{labelId:"status-filter-label",value:W,label:"Status",onChange:t=>fe(t.target.value),children:[e.jsx(T,{value:"all",children:"All Status"}),e.jsx(T,{value:"active",children:"Active"}),e.jsx(T,{value:"inactive",children:"Inactive"})]})]})]}),j()&&e.jsx(F,{variant:"contained",color:"primary",startIcon:e.jsx(Ue,{size:"18"}),onClick:je,children:"Add Scholarship"})]}),B&&!H?e.jsx(v,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:e.jsx(te,{})}):S?e.jsx(oe,{severity:"error",children:S}):e.jsx(g,{container:!0,spacing:3,children:Q.length>0?Q.map(t=>e.jsx(g,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(Be,{sx:{height:"100%",display:"flex",flexDirection:"column",borderTop:"4px solid",borderColor:t.is_active?"success.main":"error.main"},children:[e.jsxs(Ne,{sx:{flexGrow:1},children:[e.jsxs(v,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:t.name}),e.jsx(Je,{label:t.is_active?"Active":"Inactive",size:"small",color:De(t.is_active)})]}),e.jsxs(Ke,{spacing:2,children:[e.jsxs(v,{display:"flex",alignItems:"center",children:[e.jsx(St,{size:"20",style:{marginRight:"8px"}}),e.jsxs(f,{variant:"body2",children:[e.jsx("b",{children:"University:"})," ",t.university_name||"Any university"]})]}),e.jsxs(v,{display:"flex",alignItems:"center",children:[e.jsx(Ct,{size:"20",style:{marginRight:"8px"}}),e.jsxs(f,{variant:"body2",children:[e.jsx("b",{children:"Amount:"})," ",t.value?`RM ${t.value}`:"Not specified"]})]}),e.jsxs(v,{display:"flex",alignItems:"center",children:[e.jsx(Qe,{size:"20",style:{marginRight:"8px"}}),e.jsxs(f,{variant:"body2",children:[e.jsx("b",{children:"Deadline:"})," ",Ie(t.application_deadline)]})]}),t.applicable_course_levels&&t.applicable_course_levels.length>0&&e.jsxs(v,{display:"flex",alignItems:"flex-start",children:[e.jsx(et,{size:"20",style:{marginRight:"8px",marginTop:"3px"}}),e.jsxs(f,{variant:"body2",children:[e.jsx("b",{children:"Applicable for:"})," ",t.applicable_course_levels.join(", ")]})]}),t.field_of_study&&t.field_of_study.length>0&&e.jsxs(v,{display:"flex",alignItems:"flex-start",children:[e.jsx(tt,{size:"20",style:{marginRight:"8px",marginTop:"3px"}}),e.jsxs(f,{variant:"body2",children:[e.jsx("b",{children:"Field of Study:"})," ",t.field_of_study.join(", ")]})]}),t.criteria&&t.criteria.length>0&&e.jsxs(v,{mt:1,children:[e.jsx(f,{variant:"subtitle2",gutterBottom:!0,children:"Eligibility Criteria:"}),e.jsx(st,{dense:!0,disablePadding:!0,children:t.criteria.map((r,l)=>e.jsxs(at,{disablePadding:!0,sx:{mt:.5},children:[e.jsx(rt,{sx:{minWidth:24},children:e.jsx(_t,{size:"16"})}),e.jsx(it,{primary:r,primaryTypographyProps:{variant:"body2",style:{margin:0}}})]},l))})]})]})]}),e.jsx(Ze,{}),e.jsxs(pt,{sx:{justifyContent:"space-between",p:2},children:[(Y()||j())&&e.jsx(le,{control:e.jsx(de,{size:"small",checked:t.is_active,onChange:()=>ke(t),color:"success"}),label:e.jsx(f,{variant:"caption",children:t.is_active?"Active":"Inactive"})}),!Y()&&!j()&&e.jsx(v,{}),j()&&e.jsxs(v,{children:[e.jsx(ce,{title:"Edit",children:e.jsx(ne,{color:"primary",size:"small",onClick:()=>be(t),children:e.jsx(Fe,{size:"18"})})}),e.jsx(ce,{title:"Delete",children:e.jsx(ne,{color:"error",size:"small",onClick:()=>Se(t.id),children:e.jsx(Oe,{size:"18"})})})]})]})]})},t.id)):e.jsx(g,{item:!0,xs:12,children:e.jsx(Ve,{sx:{p:3,textAlign:"center"},children:e.jsxs(f,{variant:"body1",color:"textSecondary",children:["No scholarships found. ",j()?"Add a new scholarship to get started.":""]})})})}),e.jsxs(Ye,{open:H,onClose:()=>M(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(Ge,{children:J==="add"?"Add New Scholarship":"Edit Scholarship"}),e.jsx(qe,{children:e.jsxs(g,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(g,{item:!0,xs:12,sm:8,children:e.jsx($,{fullWidth:!0,label:"Scholarship Name",name:"name",value:i.name,onChange:I,required:!0})}),e.jsx(g,{item:!0,xs:12,sm:4,children:e.jsx(le,{control:e.jsx(de,{checked:i.is_active,onChange:_e,color:"success"}),label:"Active Status"})}),e.jsx(g,{item:!0,xs:12,children:e.jsx($,{fullWidth:!0,label:"Criteria (one per line)",name:"description",value:i.description,onChange:I,multiline:!0,rows:3,placeholder:"Enter each criterion on a new line",helperText:"Each line will be shown as a separate criterion point"})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsx($,{fullWidth:!0,label:"Provider",name:"provider",value:i.provider,onChange:I,placeholder:"e.g. Ministry of Education"})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsxs(ie,{fullWidth:!0,children:[e.jsx(q,{id:"university-label",children:"University"}),e.jsxs(re,{labelId:"university-label",name:"university_id",value:i.university_id,label:"University",onChange:I,children:[e.jsx(T,{value:"",children:"Any University"}),_.map(t=>e.jsx(T,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsx($,{fullWidth:!0,label:"Amount (RM)",name:"amount",value:i.amount,onChange:I,type:"number",InputProps:{startAdornment:e.jsx(q,{})}})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsx($,{fullWidth:!0,label:"Deadline",name:"deadline",value:i.deadline,onChange:I,type:"date",InputLabelProps:{shrink:!0}})}),e.jsx(g,{item:!0,xs:12,children:e.jsx($,{fullWidth:!0,label:"Field of Study (comma separated)",name:"eligibility",value:i.eligibility,onChange:I,placeholder:"e.g. Engineering, Computer Science, Business",helperText:"Separate different fields with commas"})})]})}),e.jsxs(Xe,{children:[e.jsx(F,{onClick:()=>M(!1),children:"Cancel"}),e.jsx(F,{onClick:Ce,variant:"contained",color:"primary",disabled:!i.name,children:B?e.jsx(te,{size:24}):"Save"})]})]}),e.jsx(He,{open:U.open,autoHideDuration:6e3,onClose:V,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(oe,{onClose:V,severity:U.severity,variant:"filled",children:U.message})})]})})};export{es as default};
