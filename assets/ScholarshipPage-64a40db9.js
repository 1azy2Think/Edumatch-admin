import{g as he,a as me,s as E,_,r as u,u as ve,b as ge,j as e,d as xe,e as fe,c as $,J as se,K as Me,L as Re,k as Ee,l as Le,v as N,w as M,x as b,M as Te,B as p,T as x,C as ae,E as Be,F as q,G as ie,H as Pe}from"./index-64f04cf6.js";import{P as re}from"./PageContainer-29adf5c5.js";import{D as We}from"./DashboardCard-40c00f1a.js";import{B as U}from"./Button-8e028770.js";import{T as D,F as oe,I as H}from"./TextField-e05c05df.js";import{I as Ne,a as Ue,b as Fe,c as Oe,D as Ye,d as Ge,e as qe,f as He,S as Xe}from"./IconTrash-b8ce8915.js";import{S as ne}from"./Select-5fcfafc6.js";import{M as R}from"./MenuItem-94020d08.js";import{A as le}from"./Alert-20bf53dc.js";import{G as m}from"./Grid-ff18d274.js";import{C as Je}from"./Card-8bedb7b7.js";import{C as Ke}from"./CardContent-e73d570e.js";import{C as Ve}from"./Chip-c664cc52.js";import{S as Qe}from"./Stack-023cd4df.js";import{c as X}from"./createReactComponent-5a53dfc3.js";import{I as Ze,D as et}from"./IconCalendar-e593c43d.js";import{I as tt}from"./IconSchool-f62e5a0f.js";import{I as st}from"./IconBookmark-068721ef.js";import{L as at}from"./Menu-65dba61a.js";import{a as it,L as rt}from"./ListItemText-e46ec5c1.js";import{L as ot}from"./ListItemIcon-4345ab1c.js";import{S as nt,F as ce}from"./FormControlLabel-be185e9a.js";import{T as de}from"./Tooltip-6da886ac.js";import{I as ue}from"./IconButton-88e0b2a7.js";import{P as lt}from"./Paper-a8b40727.js";import"./ButtonBase-f311f928.js";import"./isMuiElement-22d3b503.js";import"./useTheme-30be3906.js";import"./styled-81c31b6a.js";function ct(s){return he("MuiCardActions",s)}me("MuiCardActions",["root","spacing"]);const dt=["disableSpacing","className"],ut=s=>{const{classes:a,disableSpacing:n}=s;return fe({root:["root",!n&&"spacing"]},ct,a)},pt=E("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(s,a)=>{const{ownerState:n}=s;return[a.root,!n.disableSpacing&&a.spacing]}})(({ownerState:s})=>_({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(:first-of-type)":{marginLeft:8}})),ht=u.forwardRef(function(a,n){const d=ve({props:a,name:"MuiCardActions"}),{disableSpacing:y=!1,className:C}=d,S=ge(d,dt),j=_({},d,{disableSpacing:y}),k=ut(j);return e.jsx(pt,_({className:xe(k.root,C),ownerState:j,ref:n},S))}),mt=ht;function vt(s){return he("MuiSwitch",s)}const gt=me("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),c=gt,xt=["className","color","edge","size","sx"],ft=s=>{const{classes:a,edge:n,size:d,color:y,checked:C,disabled:S}=s,j={root:["root",n&&`edge${$(n)}`,`size${$(d)}`],switchBase:["switchBase",`color${$(y)}`,C&&"checked",S&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},k=fe(j,vt,a);return _({},a,k)},yt=E("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(s,a)=>{const{ownerState:n}=s;return[a.root,n.edge&&a[`edge${$(n.edge)}`],a[`size${$(n.size)}`]]}})(({ownerState:s})=>_({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},s.edge==="start"&&{marginLeft:-8},s.edge==="end"&&{marginRight:-8},s.size==="small"&&{width:40,height:24,padding:7,[`& .${c.thumb}`]:{width:16,height:16},[`& .${c.switchBase}`]:{padding:4,[`&.${c.checked}`]:{transform:"translateX(16px)"}}})),jt=E(nt,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(s,a)=>{const{ownerState:n}=s;return[a.switchBase,{[`& .${c.input}`]:a.input},n.color!=="default"&&a[`color${$(n.color)}`]]}})(({theme:s})=>({position:"absolute",top:0,left:0,zIndex:1,color:s.vars?s.vars.palette.Switch.defaultColor:`${s.palette.mode==="light"?s.palette.common.white:s.palette.grey[300]}`,transition:s.transitions.create(["left","transform"],{duration:s.transitions.duration.shortest}),[`&.${c.checked}`]:{transform:"translateX(20px)"},[`&.${c.disabled}`]:{color:s.vars?s.vars.palette.Switch.defaultDisabledColor:`${s.palette.mode==="light"?s.palette.grey[100]:s.palette.grey[600]}`},[`&.${c.checked} + .${c.track}`]:{opacity:.5},[`&.${c.disabled} + .${c.track}`]:{opacity:s.vars?s.vars.opacity.switchTrackDisabled:`${s.palette.mode==="light"?.12:.2}`},[`& .${c.input}`]:{left:"-100%",width:"300%"}}),({theme:s,ownerState:a})=>_({"&:hover":{backgroundColor:s.vars?`rgba(${s.vars.palette.action.activeChannel} / ${s.vars.palette.action.hoverOpacity})`:se(s.palette.action.active,s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},a.color!=="default"&&{[`&.${c.checked}`]:{color:(s.vars||s).palette[a.color].main,"&:hover":{backgroundColor:s.vars?`rgba(${s.vars.palette[a.color].mainChannel} / ${s.vars.palette.action.hoverOpacity})`:se(s.palette[a.color].main,s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${c.disabled}`]:{color:s.vars?s.vars.palette.Switch[`${a.color}DisabledColor`]:`${s.palette.mode==="light"?Me(s.palette[a.color].main,.62):Re(s.palette[a.color].main,.55)}`}},[`&.${c.checked} + .${c.track}`]:{backgroundColor:(s.vars||s).palette[a.color].main}})),bt=E("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(s,a)=>a.track})(({theme:s})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:s.transitions.create(["opacity","background-color"],{duration:s.transitions.duration.shortest}),backgroundColor:s.vars?s.vars.palette.common.onBackground:`${s.palette.mode==="light"?s.palette.common.black:s.palette.common.white}`,opacity:s.vars?s.vars.opacity.switchTrack:`${s.palette.mode==="light"?.38:.3}`})),_t=E("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(s,a)=>a.thumb})(({theme:s})=>({boxShadow:(s.vars||s).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),St=u.forwardRef(function(a,n){const d=ve({props:a,name:"MuiSwitch"}),{className:y,color:C="primary",edge:S=!1,size:j="medium",sx:k}=d,L=ge(d,xt),l=_({},d,{color:C,edge:S,size:j}),w=ft(l),T=e.jsx(_t,{className:w.thumb,ownerState:l});return e.jsxs(yt,{className:xe(w.root,y),sx:k,ownerState:l,children:[e.jsx(jt,_({type:"checkbox",icon:T,checkedIcon:T,ref:n,ownerState:l},L,{classes:_({},w,{root:w.switchBase})})),e.jsx(bt,{className:w.track,ownerState:l})]})}),pe=St;var wt=X("check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]),Ct=X("currency-dollar","IconCurrencyDollar",[["path",{d:"M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2",key:"svg-0"}],["path",{d:"M12 3v3m0 12v3",key:"svg-1"}]]),kt=X("world","IconWorld",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M3.6 9h16.8",key:"svg-1"}],["path",{d:"M3.6 15h16.8",key:"svg-2"}],["path",{d:"M11.5 3a17 17 0 0 0 0 18",key:"svg-3"}],["path",{d:"M12.5 3a17 17 0 0 1 0 18",key:"svg-4"}]]);const rs=()=>{const{currentUser:s,userRole:a,isAdmin:n,hasRole:d}=Ee(),y=Le(),[C,S]=u.useState([]),[j,k]=u.useState([]),[L,l]=u.useState(!0),[w,T]=u.useState(null),[J,A]=u.useState(!1),[K,V]=u.useState("add"),[B,ye]=u.useState(""),[P,je]=u.useState("all"),[r,z]=u.useState({name:"",description:"",provider:"",amount:"",deadline:"",eligibility:"",university_id:"",is_active:!0,created_at:new Date}),[W,Q]=u.useState({open:!1,message:"",severity:"success"}),F=()=>!!a,f=()=>n()||d("moderator")||d("editor"),O=()=>n()||d("moderator");u.useEffect(()=>{a!==null&&!F()&&y("/dashboard")},[a,y]),u.useEffect(()=>{F()&&be()},[a]);const be=async()=>{try{l(!0);let i=(await N(M(b,"scholarships"))).docs.map(g=>({id:g.id,...g.data(),is_active:g.data().is_active!==void 0?g.data().is_active:!0}));await Ie();const v=(await N(M(b,"universities"))).docs.map(g=>({id:g.id,...g.data()}));S(i),k(v),l(!1)}catch(t){console.error("Error fetching data:",t),T("Failed to load data. Please try again."),l(!1)}},_e=()=>{if(!f()){h("You do not have permission to add scholarships","error");return}z({name:"",description:"",provider:"",amount:"",deadline:"",eligibility:"",university_id:"",is_active:!0,created_at:new Date}),V("add"),A(!0)},Se=t=>{if(!f()){h("You do not have permission to edit scholarships","error");return}z({id:t.id,name:t.name||"",description:t.criteria?t.criteria.join(`
`):"",provider:t.university_name||"",amount:t.value||"",deadline:t.application_deadline||"",eligibility:t.field_of_study?t.field_of_study.join(", "):"",university_id:t.university_id||"",is_active:t.is_active!==void 0?t.is_active:!0,created_at:t.created_at||new Date,original_criteria:t.criteria||[],original_type:t.type||[],original_applicable_course_levels:t.applicable_course_levels||[],original_field_of_study:t.field_of_study||[],original_location:t.location||[],original_awards_details:t.awards_details||{}}),V("edit"),A(!0)},I=t=>{const{name:i,value:o}=t.target;z(i==="amount"?{...r,[i]:o===""?"":parseFloat(o)}:{...r,[i]:o})},we=t=>{z({...r,is_active:t.target.checked})},Ce=async()=>{if(!f()){h("You do not have permission to manage scholarships","error");return}try{l(!0);let t="";if(r.university_id){const o=j.find(v=>v.id===r.university_id);o&&(t=o.name)}const i={name:r.name,university_id:r.university_id,university_name:t,criteria:r.description?r.description.split(`
`).filter(o=>o.trim()!==""):[],value:r.amount,application_deadline:r.deadline,is_active:r.is_active,updated_at:new Date,type:r.original_type||[],applicable_course_levels:r.original_applicable_course_levels||[],field_of_study:r.original_field_of_study||[],location:r.original_location||[],awards_details:r.original_awards_details||{}};if(K==="add")await Be(M(b,"scholarships"),i),h("Scholarship added successfully!","success");else{const o=q(b,"scholarships",r.id),{id:v,original_criteria:g,original_type:G,original_applicable_course_levels:te,original_field_of_study:It,original_location:Dt,original_awards_details:$t,...ze}=i;await ie(o,ze,{merge:!0}),h("Scholarship updated successfully!","success")}A(!1),await Y()}catch(t){console.error("Error saving scholarship:",t),h(`Error: ${t.message}`,"error")}finally{l(!1)}},ke=async t=>{if(!f()){h("You do not have permission to delete scholarships","error");return}if(window.confirm("Are you sure you want to delete this scholarship?"))try{l(!0),await Pe(q(b,"scholarships",t)),h("Scholarship deleted successfully!","success"),await Y()}catch(i){console.error("Error deleting scholarship:",i),h(`Error: ${i.message}`,"error")}finally{l(!1)}},Ie=async()=>{try{const t=await N(M(b,"scholarships")),i=Te(b);let o=0;t.docs.forEach(v=>{v.data().is_active===void 0&&(console.log(`Setting is_active=true for scholarship: ${v.id}`),i.update(v.ref,{is_active:!0}),o++)}),o>0?(await i.commit(),console.log(`Updated is_active field for ${o} scholarships`)):console.log("All scholarships already have is_active field")}catch(t){console.error("Error initializing active status:",t)}},De=async t=>{if(!O()&&!f()){h("You do not have permission to activate/deactivate scholarships","error");return}try{l(!0);const i=q(b,"scholarships",t.id);await ie(i,{is_active:!t.is_active,updated_at:new Date},{merge:!0}),await Y(),h(`Scholarship ${t.is_active?"deactivated":"activated"} successfully!`,"success")}catch(i){console.error("Error toggling scholarship status:",i),h(`Error: ${i.message}`,"error")}finally{l(!1)}},Y=async()=>{try{const i=(await N(M(b,"scholarships"))).docs.map(o=>({id:o.id,...o.data()}));return S(i),i}catch(t){throw console.error("Error refreshing scholarships:",t),t}},h=(t,i="success")=>{Q({open:!0,message:t,severity:i})},Z=()=>{Q({...W,open:!1})},ee=C.filter(t=>{var v,g,G;const i=((v=t.name)==null?void 0:v.toLowerCase().includes(B.toLowerCase()))||((g=t.criteria)==null?void 0:g.some(te=>te.toLowerCase().includes(B.toLowerCase())))||((G=t.university_name)==null?void 0:G.toLowerCase().includes(B.toLowerCase())),o=P==="all"||P==="active"&&t.is_active||P==="inactive"&&!t.is_active;return i&&o}),$e=t=>{if(!t)return"No deadline";try{return t._seconds?new Date(t._seconds*1e3).toLocaleDateString():new Date(t).toLocaleDateString()}catch{return t}},Ae=t=>t?"success":"error";return a!==null&&!F()?e.jsx(re,{title:"Access Denied",description:"Permission required",children:e.jsxs(p,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"80vh",children:[e.jsx(x,{variant:"h4",color:"error",gutterBottom:!0,children:"Access Denied"}),e.jsx(x,{variant:"body1",children:"You don't have permission to access this page."}),e.jsx(U,{variant:"contained",color:"primary",sx:{mt:3},onClick:()=>y("/dashboard"),children:"Go to Dashboard"})]})}):e.jsx(re,{title:"Scholarship Management",description:"Manage all scholarships",children:e.jsxs(We,{title:"Scholarships",children:[e.jsxs(p,{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(p,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(D,{size:"small",placeholder:"Search scholarships...",value:B,onChange:t=>ye(t.target.value),sx:{width:300},InputProps:{startAdornment:e.jsx(Ne,{size:"20",style:{marginRight:"8px"}})}}),e.jsxs(oe,{size:"small",sx:{minWidth:120},children:[e.jsx(H,{id:"status-filter-label",children:"Status"}),e.jsxs(ne,{labelId:"status-filter-label",value:P,label:"Status",onChange:t=>je(t.target.value),children:[e.jsx(R,{value:"all",children:"All Status"}),e.jsx(R,{value:"active",children:"Active"}),e.jsx(R,{value:"inactive",children:"Inactive"})]})]})]}),f()&&e.jsx(U,{variant:"contained",color:"primary",startIcon:e.jsx(Ue,{size:"18"}),onClick:_e,children:"Add Scholarship"})]}),L&&!J?e.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:e.jsx(ae,{})}):w?e.jsx(le,{severity:"error",children:w}):e.jsx(m,{container:!0,spacing:3,children:ee.length>0?ee.map(t=>e.jsx(m,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(Je,{sx:{height:"100%",display:"flex",flexDirection:"column",borderTop:"4px solid",borderColor:t.is_active?"success.main":"error.main"},children:[e.jsxs(Ke,{sx:{flexGrow:1},children:[e.jsxs(p,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(x,{variant:"h6",gutterBottom:!0,children:t.name}),e.jsx(Ve,{label:t.is_active?"Active":"Inactive",size:"small",color:Ae(t.is_active)})]}),e.jsxs(Qe,{spacing:2,children:[e.jsxs(p,{display:"flex",alignItems:"center",children:[e.jsx(kt,{size:"20",style:{marginRight:"8px"}}),e.jsxs(x,{variant:"body2",children:[e.jsx("b",{children:"University:"})," ",t.university_name||"Any university"]})]}),e.jsxs(p,{display:"flex",alignItems:"center",children:[e.jsx(Ct,{size:"20",style:{marginRight:"8px"}}),e.jsxs(x,{variant:"body2",children:[e.jsx("b",{children:"Amount:"})," ",t.value?`RM ${t.value}`:"Not specified"]})]}),e.jsxs(p,{display:"flex",alignItems:"center",children:[e.jsx(Ze,{size:"20",style:{marginRight:"8px"}}),e.jsxs(x,{variant:"body2",children:[e.jsx("b",{children:"Deadline:"})," ",$e(t.application_deadline)]})]}),t.applicable_course_levels&&t.applicable_course_levels.length>0&&e.jsxs(p,{display:"flex",alignItems:"flex-start",children:[e.jsx(tt,{size:"20",style:{marginRight:"8px",marginTop:"3px"}}),e.jsxs(x,{variant:"body2",children:[e.jsx("b",{children:"Applicable for:"})," ",t.applicable_course_levels.join(", ")]})]}),t.field_of_study&&t.field_of_study.length>0&&e.jsxs(p,{display:"flex",alignItems:"flex-start",children:[e.jsx(st,{size:"20",style:{marginRight:"8px",marginTop:"3px"}}),e.jsxs(x,{variant:"body2",children:[e.jsx("b",{children:"Field of Study:"})," ",t.field_of_study.join(", ")]})]}),t.criteria&&t.criteria.length>0&&e.jsxs(p,{mt:1,children:[e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"Eligibility Criteria:"}),e.jsx(at,{dense:!0,disablePadding:!0,children:t.criteria.map((i,o)=>e.jsxs(it,{disablePadding:!0,sx:{mt:.5},children:[e.jsx(ot,{sx:{minWidth:24},children:e.jsx(wt,{size:"16"})}),e.jsx(rt,{primary:i,primaryTypographyProps:{variant:"body2",style:{margin:0}}})]},o))})]})]})]}),e.jsx(et,{}),e.jsxs(mt,{sx:{justifyContent:"space-between",p:2},children:[(O()||f())&&e.jsx(ce,{control:e.jsx(pe,{size:"small",checked:t.is_active,onChange:()=>De(t),color:"success"}),label:e.jsx(x,{variant:"caption",children:t.is_active?"Active":"Inactive"})}),!O()&&!f()&&e.jsx(p,{}),f()&&e.jsxs(p,{children:[e.jsx(de,{title:"Edit",children:e.jsx(ue,{color:"primary",size:"small",onClick:()=>Se(t),children:e.jsx(Fe,{size:"18"})})}),e.jsx(de,{title:"Delete",children:e.jsx(ue,{color:"error",size:"small",onClick:()=>ke(t.id),children:e.jsx(Oe,{size:"18"})})})]})]})]})},t.id)):e.jsx(m,{item:!0,xs:12,children:e.jsx(lt,{sx:{p:3,textAlign:"center"},children:e.jsxs(x,{variant:"body1",color:"textSecondary",children:["No scholarships found. ",f()?"Add a new scholarship to get started.":""]})})})}),e.jsxs(Ye,{open:J,onClose:()=>A(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(Ge,{children:K==="add"?"Add New Scholarship":"Edit Scholarship"}),e.jsx(qe,{children:e.jsxs(m,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(m,{item:!0,xs:12,sm:8,children:e.jsx(D,{fullWidth:!0,label:"Scholarship Name",name:"name",value:r.name,onChange:I,required:!0})}),e.jsx(m,{item:!0,xs:12,sm:4,children:e.jsx(ce,{control:e.jsx(pe,{checked:r.is_active,onChange:we,color:"success"}),label:"Active Status"})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(D,{fullWidth:!0,label:"Criteria (one per line)",name:"description",value:r.description,onChange:I,multiline:!0,rows:3,placeholder:"Enter each criterion on a new line",helperText:"Each line will be shown as a separate criterion point"})}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Provider",name:"provider",value:r.provider,onChange:I,placeholder:"e.g. Ministry of Education"})}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsxs(oe,{fullWidth:!0,children:[e.jsx(H,{id:"university-label",children:"University"}),e.jsxs(ne,{labelId:"university-label",name:"university_id",value:r.university_id,label:"University",onChange:I,children:[e.jsx(R,{value:"",children:"Any University"}),j.map(t=>e.jsx(R,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Amount (RM)",name:"amount",value:r.amount,onChange:I,type:"number",InputProps:{startAdornment:e.jsx(H,{})}})}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Deadline",name:"deadline",value:r.deadline,onChange:I,type:"date",InputLabelProps:{shrink:!0}})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(D,{fullWidth:!0,label:"Field of Study (comma separated)",name:"eligibility",value:r.eligibility,onChange:I,placeholder:"e.g. Engineering, Computer Science, Business",helperText:"Separate different fields with commas"})})]})}),e.jsxs(He,{children:[e.jsx(U,{onClick:()=>A(!1),children:"Cancel"}),e.jsx(U,{onClick:Ce,variant:"contained",color:"primary",disabled:!r.name,children:L?e.jsx(ae,{size:24}):"Save"})]})]}),e.jsx(Xe,{open:W.open,autoHideDuration:6e3,onClose:Z,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(le,{onClose:Z,severity:W.severity,variant:"filled",children:W.message})})]})})};export{rs as default};
