import{k as ms,r as j,j as e,B as c,T as i,C as qe,v as L,w as A,x as _,E as G,F as le,H as xs,D as ps,G as js}from"./index-e237ffcb.js";import{P as gs,C as S}from"./PageContainer-438f08df.js";import{D as vs,C as I}from"./DashboardCard-9af2fd3c.js";import{T as D}from"./Tooltip-f262598b.js";import{C as M}from"./Chip-dec8f5a0.js";import{T as m,F as P,I as T}from"./TextField-bc453406.js";import{I as bs,a as V,b as re,c as H,D as Pe,d as Te,e as Ue,f as Ne,S as fs}from"./IconTrash-30b94cb9.js";import{S as U,A as Be}from"./Select-c72bd6b3.js";import{M as x}from"./MenuItem-aa6690b8.js";import{T as Ye,a as N}from"./Tabs-f1b77108.js";import{c as W}from"./createReactComponent-1617f643.js";import{B as b}from"./Button-94b6ad7b.js";import{T as ys}from"./TableContainer-7db8b03f.js";import{P as Cs}from"./Stack-ad5be72a.js";import{T as _s,a as Ss,b as oe,c as g,d as ks}from"./TableRow-b4d435cc.js";import{I as f,L as $e}from"./Menu-34ff1fc5.js";import{G as l}from"./Grid-2fad7a3e.js";import{D as ws,I as Is}from"./IconCalendar-14c29fba.js";import{a as ce,L as de}from"./ListItemText-83e09eeb.js";import{I as X}from"./InputAdornment-a2368515.js";import"./useTheme-72ab8b2f.js";import"./ButtonBase-284552f5.js";import"./isMuiElement-2994e265.js";import"./styled-3af17cfc.js";var zs=W("category","IconCategory",[["path",{d:"M4 4h6v6h-6z",key:"svg-0"}],["path",{d:"M14 4h6v6h-6z",key:"svg-1"}],["path",{d:"M4 14h6v6h-6z",key:"svg-2"}],["path",{d:"M17 17m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-3"}]]),As=W("clock","IconClock",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 7v5l3 3",key:"svg-1"}]]),Ds=W("coin","IconCoin",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M14.8 9a2 2 0 0 0 -1.8 -1h-2a2 2 0 1 0 0 4h2a2 2 0 1 1 0 4h-2a2 2 0 0 1 -1.8 -1",key:"svg-1"}],["path",{d:"M12 7v10",key:"svg-2"}]]),Oe=W("eye","IconEye",[["path",{d:"M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-0"}],["path",{d:"M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6",key:"svg-1"}]]),Ms=W("filter","IconFilter",[["path",{d:"M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z",key:"svg-0"}]]),Fs=W("sort-ascending","IconSortAscending",[["path",{d:"M4 6l7 0",key:"svg-0"}],["path",{d:"M4 12l7 0",key:"svg-1"}],["path",{d:"M4 18l9 0",key:"svg-2"}],["path",{d:"M15 9l3 -3l3 3",key:"svg-3"}],["path",{d:"M18 6l0 12",key:"svg-4"}]]),Rs=W("x","IconX",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]);const ue=p=>{switch(p){case"Foundation":return"info";case"Diploma":return"success";case"Degree":return"primary";case"Masters":return"warning";case"PhD":return"error";default:return"default"}},it=()=>{var we,Ie,ze,Ae,De,Me,Fe,Re,Le,We,Ee;const{currentUser:p,userRole:v,isAdmin:Ls}=ms(),d={canView:!0,canCreate:v==="admin"||v==="editor",canUpdate:v==="admin"||v==="editor"||v==="moderator",canDelete:v==="admin",canApprove:v==="admin"||v==="moderator"},[he,B]=j.useState([]),[Ge,Ve]=j.useState([]),[me,He]=j.useState([]),[xe,y]=j.useState(!0),[pe,Xe]=j.useState(null),[je,Y]=j.useState(!1),[ge,E]=j.useState(!1),[k,ve]=j.useState("add"),[be,Je]=j.useState("table"),[J,Ke]=j.useState(""),[ae,Qe]=j.useState("all"),[ie,Ze]=j.useState("all"),[$,es]=j.useState(0),[r,C]=j.useState({name:"",description:"",level:"",duration:"",total_fee:"",university_id:"",primary_category:"",intakes:[],status:"draft",created_at:new Date}),[o,ss]=j.useState(null),[K,h]=j.useState({open:!1,message:"",severity:"success"});j.useEffect(()=>{(async()=>{try{y(!0);const a=(await L(A(_,"courses"))).docs.map(n=>({id:n.id,...n.data(),status:n.data().status||"approved"}));if(B(a),d.canCreate||d.canUpdate){const u=(await L(A(_,"universities"))).docs.map(O=>({id:O.id,...O.data()}));Ve(u);const z=(await L(A(_,"categories"))).docs.map(O=>({id:O.id,...O.data()}));He(z)}y(!1)}catch(t){console.error("Error fetching data:",t),Xe("Failed to load data. Please try again."),y(!1)}})()},[d.canCreate,d.canUpdate]);const ts=()=>{if(!d.canCreate){h({open:!0,message:"You do not have permission to add new courses",severity:"error"});return}try{C({name:"",description:"",level:"",duration:"",total_fee:"",university_id:"",primary_category:"",intakes:[],status:"draft",created_by:p==null?void 0:p.uid,created_at:new Date}),ve("add"),Y(!0)}catch(s){console.error("Error opening add dialog:",s),h({open:!0,message:`Error: ${s.message}`,severity:"error"})}},ne=s=>{if(!d.canUpdate){h({open:!0,message:"You do not have permission to edit courses",severity:"error"});return}try{if(!s)throw new Error("Course data is invalid");C({id:s.id,name:s.name||"",description:s.description||"",level:s.level||"",duration:s.duration||"",total_fee:s.total_fee||"",university_id:s.university_id||"",primary_category:s.primary_category||"",intakes:s.intakes||[],status:s.status||"draft",created_at:s.created_at||new Date}),ve("edit"),Y(!0)}catch(t){console.error("Error opening edit dialog:",t),h({open:!0,message:`Error: ${t.message}`,severity:"error"})}},fe=async s=>{try{y(!0),ss(s),E(!0)}catch(t){console.error("Error fetching course details:",t),h({open:!0,message:`Error: ${t.message}`,severity:"error"})}finally{y(!1)}},F=s=>{const{name:t,value:a}=s.target;C(t==="total_fee"?{...r,[t]:a===""?"":parseFloat(a)}:{...r,[t]:a})},rs=s=>{C({...r,status:s})},as=async()=>{try{if(!r.id)throw new Error("Course must be saved before submitting for approval");y(!0);const s=G(_,"courses",r.id);await le(s,{status:"pending_approval",submitted_by:p==null?void 0:p.uid,submitted_at:new Date},{merge:!0}),C({...r,status:"pending_approval",submitted_by:p==null?void 0:p.uid,submitted_at:new Date}),h({open:!0,message:"Course submitted for approval",severity:"success"});const a=(await L(A(_,"courses"))).docs.map(n=>({id:n.id,...n.data()}));B(a)}catch(s){console.error("Error submitting for approval:",s),h({open:!0,message:`Error: ${s.message}`,severity:"error"})}finally{y(!1)}},q=async(s,t)=>{if(!d.canApprove){h({open:!0,message:"You do not have permission to approve or reject courses",severity:"error"});return}try{y(!0);const a=G(_,"courses",s);await le(a,{status:t,approved_by:p==null?void 0:p.uid,approved_at:new Date},{merge:!0}),h({open:!0,message:`Course ${t==="approved"?"approved":"rejected"} successfully`,severity:"success"}),E(!1);const u=(await L(A(_,"courses"))).docs.map(w=>({id:w.id,...w.data()}));B(u)}catch(a){console.error(`Error ${t} course:`,a),h({open:!0,message:`Error: ${a.message}`,severity:"error"})}finally{y(!1)}},is=s=>{const a=s.target.value.split(",").map(n=>n.trim()).filter(n=>n!=="");C({...r,intakes:a})},Q=(s,t)=>{C({...r,fee_breakdown:{...r.fee_breakdown||{},[s]:t===""?"":parseFloat(t)}})},R=(s,t,a)=>{const n={...r.entry_requirements||{}};n[s]||(n[s]={}),t==="min_cgpa"?n[s].min_cgpa=a===""?"":parseFloat(a):t==="required_subjects"&&(n[s].required_subjects=[{min_grade:a.grade,count:parseInt(a.count)}]),C({...r,entry_requirements:n})},ns=(s,t,a)=>{const n={...r.subjects||{}};n[s]||(n[s]=[]);const u=[...n[s]];t>=u.length?u.push(a):u[t]=a;const w=u.filter(z=>z.trim()!=="");n[s]=w,C({...r,subjects:n})},ls=s=>{const t={...r.subjects||{}};t[s]||(t[s]=[]),t[s].push(""),C({...r,subjects:t})},os=(s,t)=>{const a={...r.subjects||{}};a[s]&&a[s].length>t&&(a[s].splice(t,1),a[s].length===0&&delete a[s],C({...r,subjects:a}))},ye=()=>{const s=r.subjects?Object.keys(r.subjects):[];let t=1,a=`Year ${t}`;for(;s.includes(a);)t++,a=`Year ${t}`;const n={...r.subjects||{},[a]:[""]};C({...r,subjects:n})},cs=async()=>{if(k==="add"&&!d.canCreate||k==="edit"&&!d.canUpdate){h({open:!0,message:`You do not have permission to ${k==="add"?"create":"update"} courses`,severity:"error"});return}try{y(!0);let s="";if(r.university_id){const u=await xs(G(_,"universities",r.university_id));u.exists()&&(s=u.data().name)}const t={...r,university_name:s,updated_at:new Date,updated_by:p==null?void 0:p.uid};if(k==="add")await ps(A(_,"courses"),t),h({open:!0,message:"Course added successfully!",severity:"success"});else{const u=G(_,"courses",r.id),{id:w,...z}=t;await le(u,z,{merge:!0}),h({open:!0,message:"Course updated successfully!",severity:"success"})}Y(!1);const n=(await L(A(_,"courses"))).docs.map(u=>({id:u.id,...u.data()}));B(n)}catch(s){console.error("Error saving course:",s),h({open:!0,message:`Error: ${s.message}`,severity:"error"})}finally{y(!1)}},Ce=async s=>{if(!d.canDelete){h({open:!0,message:"You do not have permission to delete courses",severity:"error"});return}if(window.confirm("Are you sure you want to delete this course?"))try{y(!0),await js(G(_,"courses",s)),h({open:!0,message:"Course deleted successfully!",severity:"success"});const a=(await L(A(_,"courses"))).docs.map(n=>({id:n.id,...n.data()}));B(a)}catch(t){console.error("Error deleting course:",t),h({open:!0,message:`Error: ${t.message}`,severity:"error"})}finally{y(!1)}},_e=()=>{h({...K,open:!1})},Z=s=>{switch(s){case"approved":return"success";case"pending_approval":return"warning";case"rejected":return"error";case"draft":default:return"default"}},ee=he.filter(s=>{var u,w,z;const t=((u=s.name)==null?void 0:u.toLowerCase().includes(J.toLowerCase()))||((w=s.description)==null?void 0:w.toLowerCase().includes(J.toLowerCase()))||((z=s.university_name)==null?void 0:z.toLowerCase().includes(J.toLowerCase())),a=ae==="all"||s.primary_category===ae,n=ie==="all"||s.level===ie;return t&&a&&n}),ds=[...new Set(he.map(s=>s.level).filter(Boolean))],Se=s=>{const t=["#2196f3","#4caf50","#f44336","#ff9800"];return t[s%t.length]},us=s=>s?Object.entries(s).map(([t,a])=>({year:t,subjects:a})):[],hs=s=>s?Object.entries(s).map(([t,a])=>({examType:t,details:a})):[],ke=()=>r.fee_breakdown?Object.values(r.fee_breakdown).reduce((s,t)=>{const a=parseFloat(t)||0;return s+a},0):0,se=s=>!r.entry_requirements||!r.entry_requirements[s]||!r.entry_requirements[s].required_subjects||!r.entry_requirements[s].required_subjects[0]?"":r.entry_requirements[s].required_subjects[0].min_grade||"",te=s=>!r.entry_requirements||!r.entry_requirements[s]||!r.entry_requirements[s].required_subjects||!r.entry_requirements[s].required_subjects[0]?"":r.entry_requirements[s].required_subjects[0].count||"";return e.jsx(gs,{title:"Course Management",description:"Manage all courses",children:e.jsxs(vs,{title:e.jsxs(c,{display:"flex",alignItems:"center",children:[e.jsx(i,{variant:"h4",children:"Courses"}),v&&v!=="admin"&&e.jsx(D,{title:`You have ${v} privileges`,children:e.jsx(M,{label:v.charAt(0).toUpperCase()+v.slice(1),size:"small",color:getRoleColor(v),sx:{ml:2}})})]}),children:[e.jsxs(c,{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(m,{size:"small",placeholder:"Search courses...",value:J,onChange:s=>Ke(s.target.value),sx:{width:300},InputProps:{startAdornment:e.jsx(bs,{size:"20",style:{marginRight:"8px"}})}}),e.jsxs(P,{size:"small",sx:{minWidth:120},children:[e.jsx(T,{id:"category-filter-label",children:"Category"}),e.jsxs(U,{labelId:"category-filter-label",value:ae,label:"Category",onChange:s=>Qe(s.target.value),children:[e.jsx(x,{value:"all",children:"All Categories"}),me.map(s=>e.jsx(x,{value:s.name,children:s.name},s.id))]})]}),e.jsxs(P,{size:"small",sx:{minWidth:120},children:[e.jsx(T,{id:"level-filter-label",children:"Level"}),e.jsxs(U,{labelId:"level-filter-label",value:ie,label:"Level",onChange:s=>Ze(s.target.value),children:[e.jsx(x,{value:"all",children:"All Levels"}),ds.map(s=>e.jsx(x,{value:s,children:s},s))]})]})]}),e.jsxs(c,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(Ye,{value:be,onChange:(s,t)=>Je(t),"aria-label":"view mode tabs",children:[e.jsx(N,{value:"table",icon:e.jsx(Ms,{size:"18"})}),e.jsx(N,{value:"grid",icon:e.jsx(Fs,{size:"18"})})]}),d.canCreate?e.jsx(b,{variant:"contained",color:"primary",startIcon:e.jsx(V,{size:"18"}),onClick:ts,children:"Add Course"}):e.jsx(D,{title:"You don't have permission to add courses",children:e.jsx("span",{children:e.jsx(b,{variant:"contained",color:"primary",startIcon:e.jsx(V,{size:"18"}),disabled:!0,children:"Add Course"})})})]})]}),xe&&!je&&!ge?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:e.jsx(qe,{})}):pe?e.jsx(Be,{severity:"error",children:pe}):e.jsx(e.Fragment,{children:be==="table"?e.jsx(ys,{component:Cs,sx:{boxShadow:"none"},children:e.jsxs(_s,{sx:{minWidth:650},"aria-label":"courses table",children:[e.jsx(Ss,{children:e.jsxs(oe,{children:[e.jsx(g,{children:"Course Name"}),e.jsx(g,{children:"University"}),e.jsx(g,{children:"Level"}),e.jsx(g,{children:"Duration"}),e.jsx(g,{children:"Fees"}),e.jsx(g,{children:"Category"}),e.jsx(g,{children:"Status"}),e.jsx(g,{children:"Actions"})]})}),e.jsx(ks,{children:ee.length>0?ee.map(s=>e.jsxs(oe,{children:[e.jsxs(g,{children:[e.jsx(i,{variant:"subtitle2",fontWeight:600,children:s.name}),s.description&&e.jsx(i,{variant:"body2",color:"textSecondary",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:s.description})]}),e.jsx(g,{children:s.university_name||"N/A"}),e.jsx(g,{children:e.jsx(M,{label:s.level||"N/A",size:"small",color:ue(s.level)})}),e.jsx(g,{children:s.duration||"N/A"}),e.jsx(g,{children:s.total_fee!==void 0&&s.total_fee!==null?`RM ${s.total_fee.toLocaleString()}`:"N/A"}),e.jsx(g,{children:s.primary_category||"N/A"}),e.jsx(g,{children:e.jsx(M,{label:s.status?s.status.replace("_"," ").toUpperCase():"DRAFT",size:"small",color:Z(s.status)})}),e.jsxs(g,{children:[e.jsx(f,{color:"info",size:"small",onClick:()=>fe(s),title:"View Details",children:e.jsx(Oe,{size:"18"})}),d.canUpdate?e.jsx(f,{color:"primary",size:"small",onClick:()=>ne(s),title:"Edit Course",children:e.jsx(re,{size:"18"})}):e.jsx(D,{title:"You don't have permission to edit",children:e.jsx("span",{children:e.jsx(f,{color:"primary",size:"small",disabled:!0,children:e.jsx(re,{size:"18"})})})}),d.canDelete?e.jsx(f,{color:"error",size:"small",onClick:()=>Ce(s.id),title:"Delete Course",children:e.jsx(H,{size:"18"})}):e.jsx(D,{title:"You don't have permission to delete",children:e.jsx("span",{children:e.jsx(f,{color:"error",size:"small",disabled:!0,children:e.jsx(H,{size:"18"})})})}),s.status==="pending_approval"&&d.canApprove&&e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Approve Course",children:e.jsx(f,{color:"success",size:"small",onClick:()=>q(s.id,"approved"),children:e.jsx(IconUserCheck,{size:"18"})})}),e.jsx(D,{title:"Reject Course",children:e.jsx(f,{color:"error",size:"small",onClick:()=>q(s.id,"rejected"),children:e.jsx(IconUserX,{size:"18"})})})]})]})]},s.id)):e.jsx(oe,{children:e.jsx(g,{colSpan:8,align:"center",children:e.jsx(i,{variant:"body2",color:"textSecondary",py:2,children:"No courses found."})})})})]})}):e.jsx(l,{container:!0,spacing:3,children:ee.length>0?ee.map((s,t)=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(S,{sx:{height:"100%",position:"relative"},children:[e.jsx(M,{label:s.status?s.status.replace("_"," ").toUpperCase():"DRAFT",size:"small",color:Z(s.status),sx:{position:"absolute",top:"10px",right:"10px",zIndex:1}}),e.jsxs(c,{sx:{position:"relative"},children:[e.jsx(c,{sx:{width:"100%",height:"140px",backgroundColor:Se(t),display:"flex",justifyContent:"center",alignItems:"center",color:"#ffffff",fontWeight:"bold"},children:s.primary_category||"Course"}),e.jsx(M,{label:s.level||"N/A",size:"small",color:ue(s.level),sx:{position:"absolute",top:"10px",left:"10px"}})]}),e.jsxs(I,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,noWrap:!0,children:s.name}),e.jsx(i,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:s.university_name||"Unknown University"}),e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1,children:[e.jsxs(i,{variant:"h6",children:["RM",(s.total_fee||0).toLocaleString()]}),e.jsx(i,{color:"textSecondary",variant:"caption",children:s.duration||"Unknown duration"})]}),e.jsxs(c,{mt:2,display:"flex",justifyContent:"space-between",children:[e.jsx(f,{size:"small",color:"info",onClick:()=>fe(s),children:e.jsx(Oe,{size:"16"})}),e.jsxs(c,{children:[d.canUpdate?e.jsx(f,{size:"small",color:"primary",onClick:()=>ne(s),children:e.jsx(re,{size:"16"})}):e.jsx(D,{title:"You don't have permission to edit",children:e.jsx("span",{children:e.jsx(f,{size:"small",color:"primary",disabled:!0,children:e.jsx(re,{size:"16"})})})}),d.canDelete?e.jsx(f,{size:"small",color:"error",onClick:()=>Ce(s.id),children:e.jsx(H,{size:"16"})}):e.jsx(D,{title:"You don't have permission to delete",children:e.jsx("span",{children:e.jsx(f,{size:"small",color:"error",disabled:!0,children:e.jsx(H,{size:"16"})})})})]})]})]})]})},s.id)):e.jsx(l,{item:!0,xs:12,children:e.jsx(i,{align:"center",color:"textSecondary",children:"No courses available to display."})})})}),e.jsx(Pe,{open:ge,onClose:()=>E(!1),fullWidth:!0,maxWidth:"md",children:o&&e.jsxs(e.Fragment,{children:[e.jsxs(Te,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(c,{display:"flex",alignItems:"center",children:[e.jsx(i,{variant:"h6",children:"Course Details"}),e.jsx(M,{label:o.status?o.status.replace("_"," ").toUpperCase():"DRAFT",size:"small",color:Z(o.status),sx:{ml:2}})]}),e.jsx(f,{onClick:()=>E(!1),children:e.jsx(Rs,{size:"18"})})]}),e.jsxs(Ue,{children:[e.jsxs(c,{sx:{mb:3},children:[e.jsx(c,{sx:{height:"100px",backgroundColor:Se(1),display:"flex",justifyContent:"center",alignItems:"center",borderRadius:1,mb:2},children:e.jsx(i,{variant:"h4",color:"white",children:o.primary_category||"Course"})}),e.jsx(i,{variant:"h5",fontWeight:600,children:o.name}),e.jsx(i,{variant:"subtitle1",color:"primary",fontWeight:500,children:o.university_name||"Unknown University"}),e.jsx(M,{label:o.level||"N/A",size:"small",color:ue(o.level),sx:{mt:1}})]}),e.jsx(ws,{sx:{my:2}}),e.jsxs(l,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(l,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Is,{size:"20",style:{marginRight:"8px",color:"#1976d2"}}),e.jsx(i,{variant:"body2",fontWeight:500,children:"Intakes"})]}),e.jsx(i,{variant:"body1",sx:{mt:1,pl:3.5},children:o.intakes&&o.intakes.length>0?o.intakes.join(", "):"No intake information"})]}),e.jsxs(l,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(As,{size:"20",style:{marginRight:"8px",color:"#1976d2"}}),e.jsx(i,{variant:"body2",fontWeight:500,children:"Duration"})]}),e.jsx(i,{variant:"body1",sx:{mt:1,pl:3.5},children:o.duration||"Not specified"})]}),e.jsxs(l,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ds,{size:"20",style:{marginRight:"8px",color:"#1976d2"}}),e.jsx(i,{variant:"body2",fontWeight:500,children:"Total Fee"})]}),e.jsx(i,{variant:"body1",sx:{mt:1,pl:3.5},children:o.total_fee!==void 0&&o.total_fee!==null?`RM ${o.total_fee.toLocaleString()}`:"Not specified"})]}),e.jsxs(l,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(zs,{size:"20",style:{marginRight:"8px",color:"#1976d2"}}),e.jsx(i,{variant:"body2",fontWeight:500,children:"Category"})]}),e.jsx(i,{variant:"body1",sx:{mt:1,pl:3.5},children:o.primary_category||"Not categorized"})]})]}),o.description&&e.jsxs(c,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",sx:{mb:1},children:"Description"}),e.jsx(i,{variant:"body1",children:o.description})]}),o.subjects&&Object.keys(o.subjects).length>0&&e.jsxs(c,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",sx:{mb:1},children:"Subjects"}),e.jsx(l,{container:!0,spacing:2,children:us(o.subjects).map((s,t)=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(S,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,sx:{mb:1},children:s.year}),e.jsx($e,{dense:!0,disablePadding:!0,children:s.subjects.map((a,n)=>e.jsx(ce,{disablePadding:!0,sx:{py:.5},children:e.jsx(de,{primary:a,primaryTypographyProps:{variant:"body2"}})},n))})]})})},t))})]}),o.entry_requirements&&Object.keys(o.entry_requirements).length>0&&e.jsxs(c,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",sx:{mb:1},children:"Entry Requirements"}),e.jsx(l,{container:!0,spacing:2,children:hs(o.entry_requirements).map((s,t)=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,sx:{mb:1},children:s.examType}),s.details.min_cgpa&&e.jsxs(i,{variant:"body2",children:["Minimum CGPA: ",s.details.min_cgpa]}),s.details.required_subjects&&e.jsxs(c,{sx:{mt:1},children:[e.jsx(i,{variant:"body2",sx:{mb:.5},children:"Required Subjects:"}),s.details.required_subjects.map((a,n)=>e.jsxs(i,{variant:"body2",sx:{pl:2},children:["â€¢ ",a.count," subject(s) with minimum grade ",a.min_grade]},n))]})]})})},t))})]}),o.fee_breakdown&&Object.keys(o.fee_breakdown).length>0&&e.jsxs(c,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",sx:{mb:1},children:"Fee Breakdown"}),e.jsx(S,{variant:"outlined",children:e.jsxs($e,{children:[Object.entries(o.fee_breakdown).map(([s,t],a)=>e.jsx(ce,{divider:a<Object.keys(o.fee_breakdown).length-1,children:e.jsx(de,{primary:s.charAt(0).toUpperCase()+s.slice(1),secondary:`RM ${parseFloat(t).toLocaleString()}`})},a)),e.jsx(ce,{sx:{bgcolor:"rgba(25, 118, 210, 0.08)"},children:e.jsx(de,{primary:"Total",secondary:`RM ${o.total_fee?o.total_fee.toLocaleString():0}`,primaryTypographyProps:{fontWeight:"bold"},secondaryTypographyProps:{fontWeight:"bold"}})})]})})]})]}),e.jsxs(Ne,{children:[e.jsx(b,{onClick:()=>E(!1),children:"Close"}),d.canUpdate&&e.jsx(b,{variant:"contained",color:"primary",onClick:()=>{E(!1),ne(o)},children:"Edit Course"}),o.status==="pending_approval"&&d.canApprove&&e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"contained",color:"success",onClick:()=>q(o.id,"approved"),children:"Approve"}),e.jsx(b,{variant:"contained",color:"error",onClick:()=>q(o.id,"rejected"),children:"Reject"})]})]})]})}),e.jsxs(Pe,{open:je,onClose:()=>Y(!1),fullWidth:!0,maxWidth:"md",scroll:"paper",children:[e.jsx(Te,{children:e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{variant:"h6",children:k==="add"?"Add New Course":"Edit Course"}),k==="edit"&&r.status&&e.jsx(M,{label:r.status.replace("_"," ").toUpperCase(),size:"small",color:Z(r.status)})]})}),e.jsx(Ue,{dividers:!0,children:e.jsxs(c,{component:"form",sx:{mt:1},children:[e.jsxs(Ye,{value:$,onChange:(s,t)=>es(t),variant:"scrollable",scrollButtons:"auto",sx:{mb:3,borderBottom:1,borderColor:"divider"},children:[e.jsx(N,{label:"Basic Information"}),e.jsx(N,{label:"Subjects"}),e.jsx(N,{label:"Fees"}),e.jsx(N,{label:"Entry Requirements"})]}),$===0&&e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:12,sm:8,children:e.jsx(m,{fullWidth:!0,label:"Course Name",name:"name",value:r.name,onChange:F,required:!0})}),e.jsx(l,{item:!0,xs:12,sm:4,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(T,{id:"level-select-label",children:"Level"}),e.jsxs(U,{labelId:"level-select-label",name:"level",value:r.level,label:"Level",onChange:F,children:[e.jsx(x,{value:"",children:"Select Level"}),e.jsx(x,{value:"Foundation",children:"Foundation"}),e.jsx(x,{value:"Diploma",children:"Diploma"}),e.jsx(x,{value:"Degree",children:"Degree"}),e.jsx(x,{value:"Masters",children:"Masters"}),e.jsx(x,{value:"PhD",children:"PhD"})]})]})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"Description",name:"description",value:r.description,onChange:F,multiline:!0,rows:3})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(T,{id:"university-select-label",children:"University"}),e.jsxs(U,{labelId:"university-select-label",name:"university_id",value:r.university_id,label:"University",onChange:F,children:[e.jsx(x,{value:"",children:"Select University"}),Ge.map(s=>e.jsx(x,{value:s.id,children:s.name},s.id))]})]})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(T,{id:"category-select-label",children:"Category"}),e.jsxs(U,{labelId:"category-select-label",name:"primary_category",value:r.primary_category,label:"Category",onChange:F,children:[e.jsx(x,{value:"",children:"Select Category"}),me.map(s=>e.jsx(x,{value:s.name,children:s.name},s.id))]})]})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Duration",name:"duration",value:r.duration,onChange:F,placeholder:"e.g. 3 years, 2 semesters"})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Intake Months (comma separated)",name:"intakes",value:((we=r.intakes)==null?void 0:we.join(", "))||"",onChange:is,placeholder:"e.g. Jan, Mar, Sep",helperText:"Enter month names separated by commas"})}),k==="edit"&&e.jsx(l,{item:!0,xs:12,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(T,{id:"status-select-label",children:"Status"}),e.jsxs(U,{labelId:"status-select-label",name:"status",value:r.status||"draft",label:"Status",onChange:s=>rs(s.target.value),disabled:!d.canApprove&&r.status!=="draft",children:[e.jsx(x,{value:"draft",children:"Draft"}),e.jsx(x,{value:"pending_approval",children:"Pending Approval"}),d.canApprove&&e.jsxs(e.Fragment,{children:[e.jsx(x,{value:"approved",children:"Approved"}),e.jsx(x,{value:"rejected",children:"Rejected"})]})]}),!d.canApprove&&r.status!=="draft"&&e.jsx(i,{variant:"caption",color:"textSecondary",children:"You need moderator or admin permissions to change the status of this course."})]})})]}),$===1&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(i,{variant:"subtitle1",children:"Course Subjects"}),e.jsx(b,{size:"small",startIcon:e.jsx(V,{size:16}),onClick:ye,children:"Add Year"})]}),r.subjects&&Object.keys(r.subjects).length>0?Object.entries(r.subjects).map(([s,t])=>e.jsx(S,{variant:"outlined",sx:{mb:3},children:e.jsxs(I,{children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(i,{variant:"subtitle1",children:s}),e.jsx(b,{size:"small",startIcon:e.jsx(V,{size:16}),onClick:()=>ls(s),children:"Add Subject"})]}),t.map((a,n)=>e.jsxs(c,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(m,{fullWidth:!0,size:"small",label:`Subject ${n+1}`,value:a,onChange:u=>ns(s,n,u.target.value)}),e.jsx(f,{color:"error",onClick:()=>os(s,n),sx:{ml:1},children:e.jsx(H,{size:18})})]},n))]})},s)):e.jsxs(c,{textAlign:"center",py:4,children:[e.jsx(i,{color:"textSecondary",mb:2,children:"No subjects added yet"}),e.jsx(b,{variant:"outlined",startIcon:e.jsx(V,{size:18}),onClick:ye,children:"Add Year 1"})]})]}),$===2&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Total Fee"}),e.jsx(m,{fullWidth:!0,label:"Total Fee (RM)",name:"total_fee",value:r.total_fee,onChange:F,type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:"RM"})},sx:{mb:3}}),e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Fee Breakdown"}),e.jsx(i,{variant:"body2",color:"textSecondary",mb:2,children:"Specify individual fee components (the sum should match the total fee)"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Registration Fee",value:((Ie=r.fee_breakdown)==null?void 0:Ie.registration)||"",onChange:s=>Q("registration",s.target.value),type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:"RM"})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Tuition Fee",value:((ze=r.fee_breakdown)==null?void 0:ze.tuition)||"",onChange:s=>Q("tuition",s.target.value),type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:"RM"})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Resource Fee",value:((Ae=r.fee_breakdown)==null?void 0:Ae.resources)||"",onChange:s=>Q("resources",s.target.value),type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:"RM"})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Other Fees",value:((De=r.fee_breakdown)==null?void 0:De.other)||"",onChange:s=>Q("other",s.target.value),type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:"RM"})}})})]}),e.jsxs(c,{mt:3,p:2,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1,children:[e.jsx(i,{variant:"subtitle2",children:"Fee Calculation"}),e.jsxs(c,{display:"flex",justifyContent:"space-between",mt:1,children:[e.jsx(i,{children:"Total Fee Components:"}),e.jsxs(i,{fontWeight:"bold",children:["RM ",ke()]})]}),e.jsxs(c,{display:"flex",justifyContent:"space-between",mt:1,children:[e.jsx(i,{children:"Main Total Fee:"}),e.jsxs(i,{fontWeight:"bold",children:["RM ",r.total_fee?r.total_fee.toLocaleString():0]})]}),r.total_fee!==ke()&&e.jsx(i,{color:"error",variant:"caption",mt:1,children:"Note: The sum of fee components doesn't match the total fee"})]})]}),$===3&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Entry Requirements"}),e.jsx(i,{variant:"body2",color:"textSecondary",mb:2,children:"Specify the entry requirements for different education backgrounds"}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",mb:2,children:"A-Levels"}),e.jsxs(c,{mb:2,children:[e.jsx(i,{variant:"body2",mb:1,children:"Required Subjects:"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(m,{fullWidth:!0,size:"small",label:"Minimum Grade",value:se("A-Levels"),onChange:s=>R("A-Levels","required_subjects",{grade:s.target.value,count:te("A-Levels")}),placeholder:"e.g. C"})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(m,{fullWidth:!0,size:"small",label:"Number of Subjects",type:"number",value:te("A-Levels"),onChange:s=>R("A-Levels","required_subjects",{grade:se("A-Levels"),count:s.target.value}),placeholder:"e.g. 2"})})]})]})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",mb:2,children:"STPM"}),e.jsx(m,{fullWidth:!0,size:"small",label:"Minimum CGPA",type:"number",value:((Fe=(Me=r.entry_requirements)==null?void 0:Me.STPM)==null?void 0:Fe.min_cgpa)||"",onChange:s=>R("STPM","min_cgpa",s.target.value),placeholder:"e.g. 2.33",InputProps:{inputProps:{min:0,max:4,step:.01}}})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",mb:2,children:"UEC"}),e.jsxs(c,{mb:2,children:[e.jsx(i,{variant:"body2",mb:1,children:"Required Subjects:"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(m,{fullWidth:!0,size:"small",label:"Minimum Grade",value:se("UEC"),onChange:s=>R("UEC","required_subjects",{grade:s.target.value,count:te("UEC")}),placeholder:"e.g. B"})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(m,{fullWidth:!0,size:"small",label:"Number of Subjects",type:"number",value:te("UEC"),onChange:s=>R("UEC","required_subjects",{grade:se("UEC"),count:s.target.value}),placeholder:"e.g. 5"})})]})]})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",mb:2,children:"Diploma"}),e.jsx(m,{fullWidth:!0,size:"small",label:"Minimum CGPA",type:"number",value:((Le=(Re=r.entry_requirements)==null?void 0:Re.Diploma)==null?void 0:Le.min_cgpa)||"",onChange:s=>R("Diploma","min_cgpa",s.target.value),placeholder:"e.g. 2.5",InputProps:{inputProps:{min:0,max:4,step:.01}}})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",mb:2,children:"Foundation"}),e.jsx(m,{fullWidth:!0,size:"small",label:"Minimum CGPA",type:"number",value:((Ee=(We=r.entry_requirements)==null?void 0:We.Foundation)==null?void 0:Ee.min_cgpa)||"",onChange:s=>R("Foundation","min_cgpa",s.target.value),placeholder:"e.g. 2.5",InputProps:{inputProps:{min:0,max:4,step:.01}}})]})})})]})]})]})}),e.jsxs(Ne,{children:[e.jsx(b,{onClick:()=>Y(!1),children:"Cancel"}),k==="edit"&&r.status==="draft"&&(v==="editor"||v==="admin")&&e.jsx(b,{variant:"outlined",color:"warning",onClick:as,children:"Submit for Approval"}),k==="edit"&&r.status==="pending_approval"&&d.canApprove&&e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"outlined",color:"success",onClick:()=>q(r.id,"approved"),children:"Approve"}),e.jsx(b,{variant:"outlined",color:"error",onClick:()=>q(r.id,"rejected"),children:"Reject"})]}),e.jsx(b,{onClick:cs,variant:"contained",color:"primary",disabled:!r.name,children:xe?e.jsx(qe,{size:24}):"Save"})]})]}),e.jsx(fs,{open:K.open,autoHideDuration:6e3,onClose:_e,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Be,{onClose:_e,severity:K.severity,variant:"filled",children:K.message})})]})})};export{it as default};
