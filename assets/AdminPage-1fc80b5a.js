import{k as ue,l as xe,r as h,j as e,B as o,T as c,C as K,v as R,w as C,x as g,E as pe,F as O,G as je,H as ve}from"./index-3658deca.js";import{P as V}from"./PageContainer-f13e2725.js";import{D as ge}from"./DashboardCard-64a0b147.js";import{B as I}from"./Button-2fd948b0.js";import{T as M,F as m,I as N}from"./TextField-71b5574c.js";import{I as X,a as fe,b as ye,c as be,D as Ce,d as Ie,e as we,f as Se,S as Ae}from"./IconTrash-4b65ec6a.js";import{S as u}from"./Select-8b79b68d.js";import{M as n}from"./MenuItem-3262695c.js";import{A as Y}from"./Alert-15fa0127.js";import{T as De}from"./TableContainer-e65c528a.js";import{P as Ue}from"./Paper-4e5249aa.js";import{T as _e,a as ze,b as P,c as d,d as Ee}from"./TableRow-b1e797ea.js";import{A as ke}from"./Avatar-69210b8b.js";import{C as w}from"./Chip-b97668ec.js";import{I as J}from"./IconButton-228a1632.js";import{G as l}from"./Grid-1a565d43.js";import{I as S}from"./InputAdornment-e70524ee.js";import{I as Re}from"./IconUser-cbf7d1e2.js";import{c as T}from"./createReactComponent-f455f93b.js";import{C as Q}from"./Card-a43a000b.js";import{C as Z}from"./CardContent-0002688a.js";import"./Stack-5171aadf.js";import"./styled-1bc89e08.js";import"./ButtonBase-4177e0d6.js";import"./isMuiElement-00f6e4f3.js";import"./useTheme-eb7184cb.js";import"./Menu-fdb2746e.js";var Me=T("key","IconKey",[["path",{d:"M16.555 3.843l3.602 3.602a2.877 2.877 0 0 1 0 4.069l-2.643 2.643a2.877 2.877 0 0 1 -4.069 0l-.301 -.301l-6.558 6.558a2 2 0 0 1 -1.239 .578l-.175 .008h-1.172a1 1 0 0 1 -.993 -.883l-.007 -.117v-1.172a2 2 0 0 1 .467 -1.284l.119 -.13l.414 -.414h2v-2h2v-2l2.144 -2.144l-.301 -.301a2.877 2.877 0 0 1 0 -4.069l2.643 -2.643a2.877 2.877 0 0 1 4.069 0z",key:"svg-0"}],["path",{d:"M15 9h.01",key:"svg-1"}]]),Ne=T("user-check","IconUserCheck",[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h4",key:"svg-1"}],["path",{d:"M15 19l2 2l4 -4",key:"svg-2"}]]),Pe=T("user-x","IconUserX",[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h3.5",key:"svg-1"}],["path",{d:"M22 22l-5 -5",key:"svg-2"}],["path",{d:"M17 22l5 -5",key:"svg-3"}]]);const Te=L=>{switch(L){case"admin":return"error";case"moderator":return"warning";case"editor":return"success";case"user":return"info";default:return"default"}},hs=()=>{const{currentUser:L,userRole:A,isAdmin:f}=ue(),D=xe(),[B,U]=h.useState([]),[W,p]=h.useState(!0),[F,ee]=h.useState(null),[se,y]=h.useState(!1),[$,q]=h.useState("add"),[_,re]=h.useState(""),[z,ae]=h.useState("all"),[i,j]=h.useState({displayName:"",email:"",role:"user",permissions:[],lastLogin:null,active:!0,created_at:new Date}),[b,x]=h.useState({open:!1,message:"",severity:"success"});h.useEffect(()=>{A!==null&&!f()&&D("/dashboard")},[A,D,f]);const te={admin:["manage_users","manage_content","manage_settings","view_reports","approve_content"],moderator:["manage_content","view_reports","approve_content"],editor:["manage_content","view_reports"],user:["view_content"]};h.useEffect(()=>{const s=async()=>{try{p(!0);const t=(await R(C(g,"users"))).docs.map(r=>({id:r.id,...r.data(),role:r.data().role||"user",permissions:r.data().permissions||[],active:r.data().active!==void 0?r.data().active:!0}));U(t),p(!1)}catch(a){console.error("Error fetching users:",a),ee("Failed to load user data. Please try again."),p(!1)}};f()&&s()},[f]);const ie=()=>{try{j({displayName:"",email:"",role:"user",permissions:["view_content"],lastLogin:null,active:!0,created_at:new Date}),q("add"),y(!0)}catch(s){console.error("Error opening add dialog:",s),x({open:!0,message:`Error: ${s.message}`,severity:"error"})}},ne=s=>{try{if(!s)throw new Error("User data is invalid");j({id:s.id,displayName:s.displayName||"",email:s.email||"",role:s.role||"user",permissions:s.permissions||[],lastLogin:s.lastLogin||null,active:s.active!==void 0?s.active:!0,created_at:s.created_at||new Date}),q("edit"),y(!0)}catch(a){console.error("Error opening edit dialog:",a),x({open:!0,message:`Error: ${a.message}`,severity:"error"})}},E=s=>{const{name:a,value:t}=s.target;j(a==="role"?{...i,role:t,permissions:te[t]||[]}:{...i,[a]:t})},v=(s,a)=>{let t=[...i.permissions];a?t.includes(s)||t.push(s):t=t.filter(r=>r!==s),j({...i,permissions:t})},le=async()=>{try{p(!0);const s={...i,updated_at:new Date};if($==="add")await pe(C(g,"users"),s),x({open:!0,message:"User added successfully!",severity:"success"});else{const r=O(g,"users",i.id),{id:k,...me}=s;await je(r,me,{merge:!0}),x({open:!0,message:"User updated successfully!",severity:"success"})}y(!1);const t=(await R(C(g,"users"))).docs.map(r=>({id:r.id,...r.data(),role:r.data().role||"user",permissions:r.data().permissions||[],active:r.data().active!==void 0?r.data().active:!0}));U(t)}catch(s){console.error("Error saving user:",s),x({open:!0,message:`Error: ${s.message}`,severity:"error"})}finally{p(!1)}},oe=async s=>{if(window.confirm("Are you sure you want to delete this user?"))try{p(!0),await ve(O(g,"users",s)),x({open:!0,message:"User deleted successfully!",severity:"success"});const t=(await R(C(g,"users"))).docs.map(r=>({id:r.id,...r.data(),role:r.data().role||"user",permissions:r.data().permissions||[],active:r.data().active!==void 0?r.data().active:!0}));U(t)}catch(a){console.error("Error deleting user:",a),x({open:!0,message:`Error: ${a.message}`,severity:"error"})}finally{p(!1)}},G=()=>{x({...b,open:!1})},H=B.filter(s=>{var r,k;const a=((r=s.displayName)==null?void 0:r.toLowerCase().includes(_.toLowerCase()))||((k=s.email)==null?void 0:k.toLowerCase().includes(_.toLowerCase())),t=z==="all"||s.role===z;return a&&t}),ce=[...new Set(B.map(s=>s.role).filter(Boolean))],de=s=>{if(!s)return"#1976d2";const a=["#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffc107","#ff9800","#ff5722"],t=s.charCodeAt(0);return a[t%a.length]},he=s=>{if(!s)return"?";const a=s.split(" ");return a.length===1?s.substring(0,1).toUpperCase():(a[0].charAt(0)+a[1].charAt(0)).toUpperCase()};return A!==null&&!f()?e.jsx(V,{title:"Access Denied",description:"Admin access required",children:e.jsxs(o,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"80vh",children:[e.jsx(c,{variant:"h4",color:"error",gutterBottom:!0,children:"Access Denied"}),e.jsx(c,{variant:"body1",children:"You don't have permission to access this page. This page requires admin privileges."}),e.jsx(I,{variant:"contained",color:"primary",sx:{mt:3},onClick:()=>D("/dashboard"),children:"Go to Dashboard"})]})}):e.jsx(V,{title:"User Role Management",description:"Manage user roles and permissions",children:e.jsxs(ge,{title:"User Administration",children:[e.jsxs(o,{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(o,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(M,{size:"small",placeholder:"Search users...",value:_,onChange:s=>re(s.target.value),sx:{width:300},InputProps:{startAdornment:e.jsx(X,{size:"20",style:{marginRight:"8px"}})}}),e.jsxs(m,{size:"small",sx:{minWidth:120},children:[e.jsx(N,{id:"role-filter-label",children:"Role"}),e.jsxs(u,{labelId:"role-filter-label",value:z,label:"Role",onChange:s=>ae(s.target.value),children:[e.jsx(n,{value:"all",children:"All Roles"}),ce.map(s=>e.jsx(n,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))]})]})]}),e.jsx(I,{variant:"contained",color:"primary",startIcon:e.jsx(fe,{size:"18"}),onClick:ie,children:"Add User"})]}),W?e.jsx(o,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:e.jsx(K,{})}):F?e.jsx(Y,{severity:"error",children:F}):e.jsx(De,{component:Ue,sx:{boxShadow:"none"},children:e.jsxs(_e,{sx:{minWidth:650},"aria-label":"users table",children:[e.jsx(ze,{children:e.jsxs(P,{children:[e.jsx(d,{children:"User"}),e.jsx(d,{children:"Email"}),e.jsx(d,{children:"Role"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Permissions"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(Ee,{children:H.length>0?H.map(s=>e.jsxs(P,{children:[e.jsx(d,{children:e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(ke,{sx:{bgcolor:de(s.displayName),width:36,height:36,mr:1.5},children:he(s.displayName)}),e.jsx(c,{variant:"subtitle2",fontWeight:600,children:s.displayName||"Unnamed User"})]})}),e.jsx(d,{children:s.email}),e.jsx(d,{children:e.jsx(w,{label:s.role.charAt(0).toUpperCase()+s.role.slice(1),size:"small",color:Te(s.role)})}),e.jsx(d,{children:e.jsx(w,{label:s.active?"Active":"Inactive",size:"small",color:s.active?"success":"default"})}),e.jsx(d,{children:e.jsxs(o,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[s.permissions&&s.permissions.length>0?s.permissions.slice(0,2).map((a,t)=>e.jsx(w,{label:a.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" "),size:"small",variant:"outlined",sx:{fontSize:"0.7rem"}},t)):e.jsx(c,{variant:"caption",color:"textSecondary",children:"No special permissions"}),s.permissions&&s.permissions.length>2&&e.jsx(w,{label:`+${s.permissions.length-2}`,size:"small",variant:"outlined",sx:{fontSize:"0.7rem"}})]})}),e.jsxs(d,{children:[e.jsx(J,{color:"primary",size:"small",onClick:()=>ne(s),children:e.jsx(ye,{size:"18"})}),e.jsx(J,{color:"error",size:"small",onClick:()=>oe(s.id),children:e.jsx(be,{size:"18"})})]})]},s.id)):e.jsx(P,{children:e.jsx(d,{colSpan:6,align:"center",children:e.jsx(c,{variant:"body2",color:"textSecondary",py:2,children:"No users found."})})})})]})}),e.jsxs(Ce,{open:se,onClose:()=>y(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(Ie,{children:$==="add"?"Add New User":"Edit User"}),e.jsx(we,{dividers:!0,children:e.jsx(o,{component:"form",sx:{mt:1},children:e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(M,{fullWidth:!0,label:"Display Name",name:"displayName",value:i.displayName,onChange:E,required:!0,InputProps:{startAdornment:e.jsx(S,{position:"start",children:e.jsx(Re,{size:20})})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(M,{fullWidth:!0,label:"Email Address",name:"email",type:"email",value:i.email,onChange:E,required:!0,InputProps:{startAdornment:e.jsx(S,{position:"start",children:e.jsx(X,{size:20})})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsxs(m,{fullWidth:!0,children:[e.jsx(N,{id:"role-select-label",children:"Role"}),e.jsxs(u,{labelId:"role-select-label",name:"role",value:i.role,label:"Role",onChange:E,startAdornment:e.jsx(S,{position:"start",children:e.jsx(Me,{size:20,style:{marginRight:"8px"}})}),children:[e.jsx(n,{value:"admin",children:"Admin"}),e.jsx(n,{value:"moderator",children:"Moderator"}),e.jsx(n,{value:"editor",children:"Editor"}),e.jsx(n,{value:"user",children:"User"})]})]})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsxs(m,{fullWidth:!0,children:[e.jsx(N,{id:"status-select-label",children:"Status"}),e.jsxs(u,{labelId:"status-select-label",name:"active",value:i.active,label:"Status",onChange:s=>j({...i,active:s.target.value}),startAdornment:e.jsx(S,{position:"start",children:i.active?e.jsx(Ne,{size:20,style:{marginRight:"8px"}}):e.jsx(Pe,{size:20,style:{marginRight:"8px"}})}),children:[e.jsx(n,{value:!0,children:"Active"}),e.jsx(n,{value:!1,children:"Inactive"})]})]})}),e.jsxs(l,{item:!0,xs:12,children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Permissions"}),e.jsx(c,{variant:"body2",color:"textSecondary",paragraph:!0,children:"Configure specific permissions for this user. Default permissions are based on their role."}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(Q,{variant:"outlined",children:e.jsxs(Z,{children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"Content Management"}),e.jsx(o,{mt:1,children:e.jsx(m,{component:"fieldset",variant:"standard",children:e.jsxs(l,{container:!0,spacing:1,children:[e.jsx(l,{item:!0,xs:12,children:e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(m,{children:e.jsxs(u,{size:"small",value:i.permissions.includes("manage_content"),onChange:s=>v("manage_content",s.target.value),children:[e.jsx(n,{value:!0,children:"Enabled"}),e.jsx(n,{value:!1,children:"Disabled"})]})}),e.jsx(c,{variant:"body2",sx:{ml:2},children:"Manage Content"})]})}),e.jsx(l,{item:!0,xs:12,children:e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(m,{children:e.jsxs(u,{size:"small",value:i.permissions.includes("approve_content"),onChange:s=>v("approve_content",s.target.value),children:[e.jsx(n,{value:!0,children:"Enabled"}),e.jsx(n,{value:!1,children:"Disabled"})]})}),e.jsx(c,{variant:"body2",sx:{ml:2},children:"Approve Content"})]})}),e.jsx(l,{item:!0,xs:12,children:e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(m,{children:e.jsxs(u,{size:"small",value:i.permissions.includes("view_content"),onChange:s=>v("view_content",s.target.value),children:[e.jsx(n,{value:!0,children:"Enabled"}),e.jsx(n,{value:!1,children:"Disabled"})]})}),e.jsx(c,{variant:"body2",sx:{ml:2},children:"View Content"})]})})]})})})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(Q,{variant:"outlined",children:e.jsxs(Z,{children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"Administration"}),e.jsx(o,{mt:1,children:e.jsx(m,{component:"fieldset",variant:"standard",children:e.jsxs(l,{container:!0,spacing:1,children:[e.jsx(l,{item:!0,xs:12,children:e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(m,{children:e.jsxs(u,{size:"small",value:i.permissions.includes("manage_users"),onChange:s=>v("manage_users",s.target.value),children:[e.jsx(n,{value:!0,children:"Enabled"}),e.jsx(n,{value:!1,children:"Disabled"})]})}),e.jsx(c,{variant:"body2",sx:{ml:2},children:"Manage Users"})]})}),e.jsx(l,{item:!0,xs:12,children:e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(m,{children:e.jsxs(u,{size:"small",value:i.permissions.includes("manage_settings"),onChange:s=>v("manage_settings",s.target.value),children:[e.jsx(n,{value:!0,children:"Enabled"}),e.jsx(n,{value:!1,children:"Disabled"})]})}),e.jsx(c,{variant:"body2",sx:{ml:2},children:"Manage Settings"})]})}),e.jsx(l,{item:!0,xs:12,children:e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(m,{children:e.jsxs(u,{size:"small",value:i.permissions.includes("view_reports"),onChange:s=>v("view_reports",s.target.value),children:[e.jsx(n,{value:!0,children:"Enabled"}),e.jsx(n,{value:!1,children:"Disabled"})]})}),e.jsx(c,{variant:"body2",sx:{ml:2},children:"View Reports"})]})})]})})})]})})})]})]})]})})}),e.jsxs(Se,{children:[e.jsx(I,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(I,{onClick:le,variant:"contained",color:"primary",disabled:!i.displayName||!i.email,children:W?e.jsx(K,{size:24}):"Save"})]})]}),e.jsx(Ae,{open:b.open,autoHideDuration:6e3,onClose:G,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Y,{onClose:G,severity:b.severity,variant:"filled",children:b.message})})]})})};export{hs as default};
