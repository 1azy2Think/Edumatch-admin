import{r as h,g as fe,a as ve,s as G,_ as x,u as be,D as Te,b as je,j as e,d as ie,e as Ce,c as C,B as N,T as O,o as $e}from"./index-3658deca.js";import{C as Se}from"./Card-a43a000b.js";import{C as Ee}from"./CardContent-0002688a.js";import{C as Pe}from"./Chip-b97668ec.js";import{A as ze}from"./Alert-15fa0127.js";import{T as Ie,a as de}from"./Tabs-fc15c5d0.js";import{T as Ne,g as ue,u as pe,I as Be}from"./IconButton-228a1632.js";import{T as he}from"./TableContainer-e65c528a.js";import{P as ge}from"./Paper-4e5249aa.js";import{T as se,a as ae,b as T,c as i,d as le}from"./TableRow-b1e797ea.js";import{c as ye}from"./createReactComponent-f455f93b.js";import{u as ke}from"./useTheme-eb7184cb.js";import{u as De}from"./ButtonBase-4177e0d6.js";const We=t=>{const n=h.useRef({});return h.useEffect(()=>{n.current=t}),n.current},Re=We;function we(t){const{badgeContent:n,invisible:o=!1,max:a=99,showZero:u=!1}=t,g=Re({badgeContent:n,max:a});let s=o;o===!1&&n===0&&!u&&(s=!0);const{badgeContent:d,max:c=a}=s?g:t,p=d&&Number(d)>c?`${c}+`:d;return{badgeContent:d,invisible:s,max:c,displayValue:p}}function Ae(t){return fe("MuiCollapse",t)}ve("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Ue=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Le=t=>{const{orientation:n,classes:o}=t,a={root:["root",`${n}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${n}`],wrapperInner:["wrapperInner",`${n}`]};return Ce(a,Ae,o)},Me=G("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:o}=t;return[n.root,n[o.orientation],o.state==="entered"&&n.entered,o.state==="exited"&&!o.in&&o.collapsedSize==="0px"&&n.hidden]}})(({theme:t,ownerState:n})=>x({height:0,overflow:"hidden",transition:t.transitions.create("height")},n.orientation==="horizontal"&&{height:"auto",width:0,transition:t.transitions.create("width")},n.state==="entered"&&x({height:"auto",overflow:"visible"},n.orientation==="horizontal"&&{width:"auto"}),n.state==="exited"&&!n.in&&n.collapsedSize==="0px"&&{visibility:"hidden"})),_e=G("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(t,n)=>n.wrapper})(({ownerState:t})=>x({display:"flex",width:"100%"},t.orientation==="horizontal"&&{width:"auto",height:"100%"})),Fe=G("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(t,n)=>n.wrapperInner})(({ownerState:t})=>x({width:"100%"},t.orientation==="horizontal"&&{width:"auto",height:"100%"})),Oe=h.forwardRef(function(n,o){const a=be({props:n,name:"MuiCollapse"}),{addEndListener:u,children:g,className:s,collapsedSize:d="0px",component:c,easing:p,in:E,onEnter:$,onEntered:y,onEntering:B,onExit:w,onExited:A,onExiting:m,orientation:f="vertical",style:l,timeout:b=Te.standard,TransitionComponent:U=Ne}=a,L=je(a,Ue),S=x({},a,{orientation:f,collapsedSize:d}),P=Le(S),M=ke(),q=h.useRef(),R=h.useRef(null),F=h.useRef(),_=typeof d=="number"?`${d}px`:d,k=f==="horizontal",D=k?"width":"height";h.useEffect(()=>()=>{clearTimeout(q.current)},[]);const W=h.useRef(null),te=De(o,W),z=r=>v=>{if(r){const j=W.current;v===void 0?r(j):r(j,v)}},H=()=>R.current?R.current[k?"clientWidth":"clientHeight"]:0,K=z((r,v)=>{R.current&&k&&(R.current.style.position="absolute"),r.style[D]=_,$&&$(r,v)}),Q=z((r,v)=>{const j=H();R.current&&k&&(R.current.style.position="");const{duration:Z,easing:ne}=ue({style:l,timeout:b,easing:p},{mode:"enter"});if(b==="auto"){const ce=M.transitions.getAutoHeightDuration(j);r.style.transitionDuration=`${ce}ms`,F.current=ce}else r.style.transitionDuration=typeof Z=="string"?Z:`${Z}ms`;r.style[D]=`${j}px`,r.style.transitionTimingFunction=ne,B&&B(r,v)}),V=z((r,v)=>{r.style[D]="auto",y&&y(r,v)}),X=z(r=>{r.style[D]=`${H()}px`,w&&w(r)}),Y=z(A),ee=z(r=>{const v=H(),{duration:j,easing:Z}=ue({style:l,timeout:b,easing:p},{mode:"exit"});if(b==="auto"){const ne=M.transitions.getAutoHeightDuration(v);r.style.transitionDuration=`${ne}ms`,F.current=ne}else r.style.transitionDuration=typeof j=="string"?j:`${j}ms`;r.style[D]=_,r.style.transitionTimingFunction=Z,m&&m(r)}),J=r=>{b==="auto"&&(q.current=setTimeout(r,F.current||0)),u&&u(W.current,r)};return e.jsx(U,x({in:E,onEnter:K,onEntered:V,onEntering:Q,onExit:X,onExited:Y,onExiting:ee,addEndListener:J,nodeRef:W,timeout:b==="auto"?null:b},L,{children:(r,v)=>e.jsx(Me,x({as:c,className:ie(P.root,s,{entered:P.entered,exited:!E&&_==="0px"&&P.hidden}[r]),style:x({[k?"minWidth":"minHeight"]:_},l),ownerState:x({},S,{state:r}),ref:te},v,{children:e.jsx(_e,{ownerState:x({},S,{state:r}),className:P.wrapper,ref:R,children:e.jsx(Fe,{ownerState:x({},S,{state:r}),className:P.wrapperInner,children:g})})}))}))});Oe.muiSupportAuto=!0;const He=Oe;function Ve(t){return fe("MuiBadge",t)}const Je=ve("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),I=Je,Ze=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],oe=10,re=4,Ge=t=>{const{color:n,anchorOrigin:o,invisible:a,overlap:u,variant:g,classes:s={}}=t,d={root:["root"],badge:["badge",g,a&&"invisible",`anchorOrigin${C(o.vertical)}${C(o.horizontal)}`,`anchorOrigin${C(o.vertical)}${C(o.horizontal)}${C(u)}`,`overlap${C(u)}`,n!=="default"&&`color${C(n)}`]};return Ce(d,Ve,s)},qe=G("span",{name:"MuiBadge",slot:"Root",overridesResolver:(t,n)=>n.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),Ke=G("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(t,n)=>{const{ownerState:o}=t;return[n.badge,n[o.variant],n[`anchorOrigin${C(o.anchorOrigin.vertical)}${C(o.anchorOrigin.horizontal)}${C(o.overlap)}`],o.color!=="default"&&n[`color${C(o.color)}`],o.invisible&&n.invisible]}})(({theme:t,ownerState:n})=>x({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:oe*2,lineHeight:1,padding:"0 6px",height:oe*2,borderRadius:oe,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen})},n.color!=="default"&&{backgroundColor:(t.vars||t).palette[n.color].main,color:(t.vars||t).palette[n.color].contrastText},n.variant==="dot"&&{borderRadius:re,height:re*2,minWidth:re*2,padding:0},n.anchorOrigin.vertical==="top"&&n.anchorOrigin.horizontal==="right"&&n.overlap==="rectangular"&&{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${I.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}},n.anchorOrigin.vertical==="bottom"&&n.anchorOrigin.horizontal==="right"&&n.overlap==="rectangular"&&{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${I.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}},n.anchorOrigin.vertical==="top"&&n.anchorOrigin.horizontal==="left"&&n.overlap==="rectangular"&&{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${I.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}},n.anchorOrigin.vertical==="bottom"&&n.anchorOrigin.horizontal==="left"&&n.overlap==="rectangular"&&{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${I.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}},n.anchorOrigin.vertical==="top"&&n.anchorOrigin.horizontal==="right"&&n.overlap==="circular"&&{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${I.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}},n.anchorOrigin.vertical==="bottom"&&n.anchorOrigin.horizontal==="right"&&n.overlap==="circular"&&{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${I.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}},n.anchorOrigin.vertical==="top"&&n.anchorOrigin.horizontal==="left"&&n.overlap==="circular"&&{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${I.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}},n.anchorOrigin.vertical==="bottom"&&n.anchorOrigin.horizontal==="left"&&n.overlap==="circular"&&{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${I.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}},n.invisible&&{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})})),Qe=h.forwardRef(function(n,o){var a,u,g,s,d,c;const p=be({props:n,name:"MuiBadge"}),{anchorOrigin:E={vertical:"top",horizontal:"right"},className:$,component:y,components:B={},componentsProps:w={},children:A,overlap:m="rectangular",color:f="default",invisible:l=!1,max:b=99,badgeContent:U,slots:L,slotProps:S,showZero:P=!1,variant:M="standard"}=p,q=je(p,Ze),{badgeContent:R,invisible:F,max:_,displayValue:k}=we({max:b,invisible:l,badgeContent:U,showZero:P}),D=Re({anchorOrigin:E,color:f,overlap:m,variant:M,badgeContent:U}),W=F||R==null&&M!=="dot",{color:te=f,overlap:z=m,anchorOrigin:H=E,variant:K=M}=W?D:p,Q=K!=="dot"?k:void 0,V=x({},p,{badgeContent:R,invisible:W,max:_,displayValue:Q,showZero:P,anchorOrigin:H,color:te,overlap:z,variant:K}),X=Ge(V),Y=(a=(u=L==null?void 0:L.root)!=null?u:B.Root)!=null?a:qe,ee=(g=(s=L==null?void 0:L.badge)!=null?s:B.Badge)!=null?g:Ke,J=(d=S==null?void 0:S.root)!=null?d:w.root,r=(c=S==null?void 0:S.badge)!=null?c:w.badge,v=pe({elementType:Y,externalSlotProps:J,externalForwardedProps:q,additionalProps:{ref:o,as:y},ownerState:V,className:ie(J==null?void 0:J.className,X.root,$)}),j=pe({elementType:ee,externalSlotProps:r,ownerState:V,className:ie(X.badge,r==null?void 0:r.className)});return e.jsxs(Y,x({},v,{children:[A,e.jsx(ee,x({},j,{children:Q}))]}))}),me=Qe;var Xe=ye("chevron-down","IconChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]),Ye=ye("chevron-up","IconChevronUp",[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]]);const en=(t=null)=>{const[n,o]=h.useState(!1),[a,u]=h.useState(null),[g,s]=h.useState({connectionCount:0,activeUsers:0,activeCourses:0}),[d,c]=h.useState([]),[p,E]=h.useState([]),$=h.useRef(null),y=h.useRef(null);h.useEffect(()=>{const A=`ws://localhost:8080/user?userId=${t||`anonymous-${Math.random().toString(36).substring(2,10)}`}`;console.log(`Attempting to connect to: ${A}`);const m=new WebSocket(A);return $.current=m,m.addEventListener("open",()=>{console.log("WebSocket connection established successfully"),o(!0),u(null),m.send(JSON.stringify({type:"connect",data:{platform:"admin-dashboard",role:"admin"}})),B()}),m.addEventListener("message",f=>{console.log("Received message from WebSocket:",f.data);try{const l=JSON.parse(f.data);switch(l.type){case"init":console.log("Received init message:",l),l.stats&&(s({connectionCount:l.stats.connectionCount||0,activeUsers:l.stats.activeUsers||0,activeCourses:l.stats.activeCourses||0}),c(l.stats.recentInteractions||[]),E(l.stats.recentScoreChanges||[]));break;case"stats_update":console.log("Received stats update:",l),s({connectionCount:l.connectionCount||0,activeUsers:l.activeUsers||0,activeCourses:l.activeCourses||0});break;case"interaction_update":console.log("Received interaction update:",l),l.data&&c(b=>[l.data,...b].slice(0,50));break;case"score_changes_update":console.log("Received score changes update:",l),l.data&&E(b=>[l.data,...b].slice(0,50));break;default:console.log("Unknown message type:",l.type)}}catch(l){console.error("Error parsing WebSocket message:",l)}}),m.addEventListener("close",f=>{console.log(`WebSocket connection closed. Code: ${f.code}, Reason: ${f.reason}`),o(!1),y.current&&clearInterval(y.current),f.code!==1e3&&(console.log("Abnormal closure. Attempting to reconnect in 5 seconds..."),setTimeout(()=>{console.log("Attempting to reconnect..."),u("Connection lost. Reconnecting...")},5e3))}),m.addEventListener("error",f=>{console.error("WebSocket error:",f),o(!1),u("Failed to connect to WebSocket server. Please check if the server is running.")}),()=>{console.log("Cleaning up WebSocket connection"),(m.readyState===WebSocket.OPEN||m.readyState===WebSocket.CONNECTING)&&m.close(1e3,"Component unmounted"),y.current&&clearInterval(y.current)}},[t,a]);const B=()=>{y.current=setInterval(()=>{$.current&&$.current.readyState===WebSocket.OPEN&&(console.log("Sending heartbeat"),$.current.send(JSON.stringify({type:"heartbeat"})))},3e4)};return{isConnected:n,connectionError:a,stats:g,recentInteractions:d,scoreChanges:p}},xe=t=>{const{children:n,value:o,index:a,...u}=t;return e.jsx("div",{role:"tabpanel",hidden:o!==a,id:`tabpanel-${a}`,"aria-labelledby":`tab-${a}`,...u,children:o===a&&e.jsx(N,{p:2,children:n})})},nn=({change:t})=>{var g;const[n,o]=h.useState(!1),a=s=>typeof s=="number"?s.toFixed(2):"0.00",u=s=>{if(!s)return"N/A";const d=new Date(s);return`${d.toLocaleDateString()} ${d.toLocaleTimeString()}`};return e.jsxs($e.Fragment,{children:[e.jsxs(T,{sx:{"& > *":{borderBottom:"unset"}},children:[e.jsx(i,{children:e.jsx(Be,{"aria-label":"expand row",size:"small",onClick:()=>o(!n),children:n?e.jsx(Ye,{}):e.jsx(Xe,{})})}),e.jsx(i,{children:u(t.timestamp)}),e.jsx(i,{children:t.userId}),e.jsx(i,{children:t.actionType}),e.jsxs(i,{children:[((g=t.changes)==null?void 0:g.length)||0," courses"]})]}),e.jsx(T,{children:e.jsx(i,{style:{paddingBottom:0,paddingTop:0},colSpan:6,children:e.jsx(He,{in:n,timeout:"auto",unmountOnExit:!0,children:e.jsxs(N,{sx:{margin:1},children:[e.jsx(O,{variant:"h6",gutterBottom:!0,component:"div",children:"Affected Courses"}),e.jsxs(se,{size:"small","aria-label":"affected-courses",children:[e.jsx(ae,{children:e.jsxs(T,{children:[e.jsx(i,{children:"Course Name"}),e.jsx(i,{align:"right",children:"Old Score"}),e.jsx(i,{align:"right",children:"Change"}),e.jsx(i,{align:"right",children:"New Score"}),e.jsx(i,{children:"Reason"})]})}),e.jsxs(le,{children:[t.changes&&t.changes.map((s,d)=>e.jsxs(T,{children:[e.jsx(i,{component:"th",scope:"row",children:s.courseName||s.courseId||"Unknown Course"}),e.jsx(i,{align:"right",children:a(s.oldScore)}),e.jsxs(i,{align:"right",sx:{color:s.scoreDelta>0?"success.main":"error.main",fontWeight:"bold"},children:[s.scoreDelta>0?"+":"",a(s.scoreDelta)]}),e.jsx(i,{align:"right",children:a(s.newScore)}),e.jsx(i,{children:s.reason||"No reason provided"})]},d)),(!t.changes||t.changes.length===0)&&e.jsx(T,{children:e.jsx(i,{colSpan:5,align:"center",children:"No course details available"})})]})]})]})})})})]})},xn=()=>{const[t,n]=h.useState(0),{isConnected:o,stats:a,recentInteractions:u,scoreChanges:g}=en(),s=(c,p)=>{n(p)},d=c=>{if(!c)return"N/A";const p=new Date(c);return`${p.toLocaleDateString()} ${p.toLocaleTimeString()}`};return e.jsx(Se,{variant:"outlined",children:e.jsxs(Ee,{children:[e.jsxs(N,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(O,{variant:"h5",children:"Realtime System Monitor"}),e.jsx(Pe,{label:o?"Connected":"Disconnected",color:o?"success":"error",size:"small"})]}),e.jsxs(N,{display:"flex",justifyContent:"space-around",mb:3,children:[e.jsxs(N,{textAlign:"center",children:[e.jsx(O,{variant:"h3",children:a.connectionCount}),e.jsx(O,{variant:"body2",children:"Active Connections"})]}),e.jsxs(N,{textAlign:"center",children:[e.jsx(O,{variant:"h3",children:a.activeUsers}),e.jsx(O,{variant:"body2",children:"Active Users"})]}),e.jsxs(N,{textAlign:"center",children:[e.jsx(O,{variant:"h3",children:a.activeCourses}),e.jsx(O,{variant:"body2",children:"Active Courses"})]})]}),!o&&e.jsx(ze,{severity:"warning",sx:{mb:2},children:"WebSocket connection lost. Real-time updates are not available."}),e.jsx(N,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ie,{value:t,onChange:s,"aria-label":"realtime data tabs",children:[e.jsx(de,{label:e.jsx(me,{badgeContent:u.length,color:"primary",children:e.jsx(O,{children:"User Interactions"})}),id:"tab-0"}),e.jsx(de,{label:e.jsx(me,{badgeContent:g.length,color:"secondary",children:e.jsx(O,{children:"Score Changes"})}),id:"tab-1"})]})}),e.jsx(xe,{value:t,index:0,children:e.jsx(he,{component:ge,variant:"outlined",children:e.jsxs(se,{size:"small",children:[e.jsx(ae,{children:e.jsxs(T,{children:[e.jsx(i,{children:"Time"}),e.jsx(i,{children:"User"}),e.jsx(i,{children:"Action"}),e.jsx(i,{children:"Entity"}),e.jsx(i,{children:"Type"})]})}),e.jsx(le,{children:u.length>0?u.map((c,p)=>e.jsxs(T,{children:[e.jsx(i,{children:d(c.timestamp)}),e.jsx(i,{children:c.userId}),e.jsx(i,{children:c.interactionType||c.type}),e.jsx(i,{children:c.entityName||c.course}),e.jsx(i,{children:c.entityType||"course"})]},p)):e.jsx(T,{children:e.jsx(i,{colSpan:5,align:"center",children:"No interaction data available"})})})]})})}),e.jsx(xe,{value:t,index:1,children:e.jsx(he,{component:ge,variant:"outlined",children:e.jsxs(se,{size:"small",children:[e.jsx(ae,{children:e.jsxs(T,{children:[e.jsx(i,{width:"50px"})," ",e.jsx(i,{children:"Time"}),e.jsx(i,{children:"User"}),e.jsx(i,{children:"Action"}),e.jsx(i,{children:"Affected"})]})}),e.jsx(le,{children:g.length>0?g.map((c,p)=>e.jsx(nn,{change:c},p)):e.jsx(T,{children:e.jsx(i,{colSpan:5,align:"center",children:"No score change data available"})})})]})})})]})})};export{xn as default};
