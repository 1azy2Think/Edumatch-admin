import{k as mt,r as j,j as e,B as c,T as i,C as qe,v as L,w as A,x as _,F as G,G as le,I as pt,E as xt,H as jt}from"./index-3658deca.js";import{P as gt}from"./PageContainer-f13e2725.js";import{D as vt}from"./DashboardCard-64a0b147.js";import{T as D}from"./Tooltip-da4e2ab3.js";import{C as M}from"./Chip-b97668ec.js";import{T as p,F as P,I as T}from"./TextField-71b5574c.js";import{I as bt,a as V,b as re,c as H,D as Pe,d as Te,e as Ue,f as Ne,S as ft}from"./IconTrash-4b65ec6a.js";import{S as U}from"./Select-8b79b68d.js";import{M as x}from"./MenuItem-3262695c.js";import{T as Be,a as N}from"./Tabs-fc15c5d0.js";import{c as W}from"./createReactComponent-f455f93b.js";import{B as b}from"./Button-2fd948b0.js";import{A as Ye}from"./Alert-15fa0127.js";import{T as yt}from"./TableContainer-e65c528a.js";import{P as Ct}from"./Paper-4e5249aa.js";import{T as _t,a as St,b as oe,c as g,d as kt}from"./TableRow-b1e797ea.js";import{I as f}from"./IconButton-228a1632.js";import{G as l}from"./Grid-1a565d43.js";import{C as S}from"./Card-a43a000b.js";import{C as I}from"./CardContent-0002688a.js";import{D as wt,I as It}from"./IconCalendar-085305b9.js";import{L as $e}from"./Menu-fdb2746e.js";import{a as ce,L as de}from"./ListItemText-2af907d7.js";import{I as X}from"./InputAdornment-e70524ee.js";import"./Stack-5171aadf.js";import"./styled-1bc89e08.js";import"./useTheme-eb7184cb.js";import"./ButtonBase-4177e0d6.js";import"./isMuiElement-00f6e4f3.js";var zt=W("category","IconCategory",[["path",{d:"M4 4h6v6h-6z",key:"svg-0"}],["path",{d:"M14 4h6v6h-6z",key:"svg-1"}],["path",{d:"M4 14h6v6h-6z",key:"svg-2"}],["path",{d:"M17 17m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-3"}]]),At=W("clock","IconClock",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 7v5l3 3",key:"svg-1"}]]),Dt=W("coin","IconCoin",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M14.8 9a2 2 0 0 0 -1.8 -1h-2a2 2 0 1 0 0 4h2a2 2 0 1 1 0 4h-2a2 2 0 0 1 -1.8 -1",key:"svg-1"}],["path",{d:"M12 7v10",key:"svg-2"}]]),Oe=W("eye","IconEye",[["path",{d:"M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-0"}],["path",{d:"M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6",key:"svg-1"}]]),Mt=W("filter","IconFilter",[["path",{d:"M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z",key:"svg-0"}]]),Ft=W("sort-ascending","IconSortAscending",[["path",{d:"M4 6l7 0",key:"svg-0"}],["path",{d:"M4 12l7 0",key:"svg-1"}],["path",{d:"M4 18l9 0",key:"svg-2"}],["path",{d:"M15 9l3 -3l3 3",key:"svg-3"}],["path",{d:"M18 6l0 12",key:"svg-4"}]]),Rt=W("x","IconX",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]);const ue=h=>{switch(h){case"Foundation":return"info";case"Diploma":return"success";case"Degree":return"primary";case"Masters":return"warning";case"PhD":return"error";default:return"default"}},Lt=h=>{switch(h){case"admin":return"error";case"moderator":return"warning";case"editor":return"success";case"user":return"info";default:return"default"}},us=()=>{var we,Ie,ze,Ae,De,Me,Fe,Re,Le,We,Ee;const{currentUser:h,userRole:v,isAdmin:Wt}=mt(),d={canView:!0,canCreate:v==="admin"||v==="editor",canUpdate:v==="admin"||v==="editor"||v==="moderator",canDelete:v==="admin",canApprove:v==="admin"||v==="moderator"},[he,B]=j.useState([]),[Ge,Ve]=j.useState([]),[me,He]=j.useState([]),[pe,y]=j.useState(!0),[xe,Xe]=j.useState(null),[je,Y]=j.useState(!1),[ge,E]=j.useState(!1),[k,ve]=j.useState("add"),[be,Je]=j.useState("table"),[J,Ke]=j.useState(""),[ae,Qe]=j.useState("all"),[ie,Ze]=j.useState("all"),[$,et]=j.useState(0),[r,C]=j.useState({name:"",description:"",level:"",duration:"",total_fee:"",university_id:"",primary_category:"",intakes:[],status:"draft",created_at:new Date}),[o,tt]=j.useState(null),[K,m]=j.useState({open:!1,message:"",severity:"success"});j.useEffect(()=>{(async()=>{try{y(!0);const a=(await L(A(_,"courses"))).docs.map(n=>({id:n.id,...n.data(),status:n.data().status||"approved"}));if(B(a),d.canCreate||d.canUpdate){const u=(await L(A(_,"universities"))).docs.map(O=>({id:O.id,...O.data()}));Ve(u);const z=(await L(A(_,"categories"))).docs.map(O=>({id:O.id,...O.data()}));He(z)}y(!1)}catch(s){console.error("Error fetching data:",s),Xe("Failed to load data. Please try again."),y(!1)}})()},[d.canCreate,d.canUpdate]);const st=()=>{if(!d.canCreate){m({open:!0,message:"You do not have permission to add new courses",severity:"error"});return}try{C({name:"",description:"",level:"",duration:"",total_fee:"",university_id:"",primary_category:"",intakes:[],status:"draft",created_by:h==null?void 0:h.uid,created_at:new Date}),ve("add"),Y(!0)}catch(t){console.error("Error opening add dialog:",t),m({open:!0,message:`Error: ${t.message}`,severity:"error"})}},ne=t=>{if(!d.canUpdate){m({open:!0,message:"You do not have permission to edit courses",severity:"error"});return}try{if(!t)throw new Error("Course data is invalid");C({id:t.id,name:t.name||"",description:t.description||"",level:t.level||"",duration:t.duration||"",total_fee:t.total_fee||"",university_id:t.university_id||"",primary_category:t.primary_category||"",intakes:t.intakes||[],status:t.status||"draft",created_at:t.created_at||new Date}),ve("edit"),Y(!0)}catch(s){console.error("Error opening edit dialog:",s),m({open:!0,message:`Error: ${s.message}`,severity:"error"})}},fe=async t=>{try{y(!0),tt(t),E(!0)}catch(s){console.error("Error fetching course details:",s),m({open:!0,message:`Error: ${s.message}`,severity:"error"})}finally{y(!1)}},F=t=>{const{name:s,value:a}=t.target;C(s==="total_fee"?{...r,[s]:a===""?"":parseFloat(a)}:{...r,[s]:a})},rt=t=>{C({...r,status:t})},at=async()=>{try{if(!r.id)throw new Error("Course must be saved before submitting for approval");y(!0);const t=G(_,"courses",r.id);await le(t,{status:"pending_approval",submitted_by:h==null?void 0:h.uid,submitted_at:new Date},{merge:!0}),C({...r,status:"pending_approval",submitted_by:h==null?void 0:h.uid,submitted_at:new Date}),m({open:!0,message:"Course submitted for approval",severity:"success"});const a=(await L(A(_,"courses"))).docs.map(n=>({id:n.id,...n.data()}));B(a)}catch(t){console.error("Error submitting for approval:",t),m({open:!0,message:`Error: ${t.message}`,severity:"error"})}finally{y(!1)}},q=async(t,s)=>{if(!d.canApprove){m({open:!0,message:"You do not have permission to approve or reject courses",severity:"error"});return}try{y(!0);const a=G(_,"courses",t);await le(a,{status:s,approved_by:h==null?void 0:h.uid,approved_at:new Date},{merge:!0}),m({open:!0,message:`Course ${s==="approved"?"approved":"rejected"} successfully`,severity:"success"}),E(!1);const u=(await L(A(_,"courses"))).docs.map(w=>({id:w.id,...w.data()}));B(u)}catch(a){console.error(`Error ${s} course:`,a),m({open:!0,message:`Error: ${a.message}`,severity:"error"})}finally{y(!1)}},it=t=>{const a=t.target.value.split(",").map(n=>n.trim()).filter(n=>n!=="");C({...r,intakes:a})},Q=(t,s)=>{C({...r,fee_breakdown:{...r.fee_breakdown||{},[t]:s===""?"":parseFloat(s)}})},R=(t,s,a)=>{const n={...r.entry_requirements||{}};n[t]||(n[t]={}),s==="min_cgpa"?n[t].min_cgpa=a===""?"":parseFloat(a):s==="required_subjects"&&(n[t].required_subjects=[{min_grade:a.grade,count:parseInt(a.count)}]),C({...r,entry_requirements:n})},nt=(t,s,a)=>{const n={...r.subjects||{}};n[t]||(n[t]=[]);const u=[...n[t]];s>=u.length?u.push(a):u[s]=a;const w=u.filter(z=>z.trim()!=="");n[t]=w,C({...r,subjects:n})},lt=t=>{const s={...r.subjects||{}};s[t]||(s[t]=[]),s[t].push(""),C({...r,subjects:s})},ot=(t,s)=>{const a={...r.subjects||{}};a[t]&&a[t].length>s&&(a[t].splice(s,1),a[t].length===0&&delete a[t],C({...r,subjects:a}))},ye=()=>{const t=r.subjects?Object.keys(r.subjects):[];let s=1,a=`Year ${s}`;for(;t.includes(a);)s++,a=`Year ${s}`;const n={...r.subjects||{},[a]:[""]};C({...r,subjects:n})},ct=async()=>{if(k==="add"&&!d.canCreate||k==="edit"&&!d.canUpdate){m({open:!0,message:`You do not have permission to ${k==="add"?"create":"update"} courses`,severity:"error"});return}try{y(!0);let t="";if(r.university_id){const u=await pt(G(_,"universities",r.university_id));u.exists()&&(t=u.data().name)}const s={...r,university_name:t,updated_at:new Date,updated_by:h==null?void 0:h.uid};if(k==="add")await xt(A(_,"courses"),s),m({open:!0,message:"Course added successfully!",severity:"success"});else{const u=G(_,"courses",r.id),{id:w,...z}=s;await le(u,z,{merge:!0}),m({open:!0,message:"Course updated successfully!",severity:"success"})}Y(!1);const n=(await L(A(_,"courses"))).docs.map(u=>({id:u.id,...u.data()}));B(n)}catch(t){console.error("Error saving course:",t),m({open:!0,message:`Error: ${t.message}`,severity:"error"})}finally{y(!1)}},Ce=async t=>{if(!d.canDelete){m({open:!0,message:"You do not have permission to delete courses",severity:"error"});return}if(window.confirm("Are you sure you want to delete this course?"))try{y(!0),await jt(G(_,"courses",t)),m({open:!0,message:"Course deleted successfully!",severity:"success"});const a=(await L(A(_,"courses"))).docs.map(n=>({id:n.id,...n.data()}));B(a)}catch(s){console.error("Error deleting course:",s),m({open:!0,message:`Error: ${s.message}`,severity:"error"})}finally{y(!1)}},_e=()=>{m({...K,open:!1})},Z=t=>{switch(t){case"approved":return"success";case"pending_approval":return"warning";case"rejected":return"error";case"draft":default:return"default"}},ee=he.filter(t=>{var u,w,z;const s=((u=t.name)==null?void 0:u.toLowerCase().includes(J.toLowerCase()))||((w=t.description)==null?void 0:w.toLowerCase().includes(J.toLowerCase()))||((z=t.university_name)==null?void 0:z.toLowerCase().includes(J.toLowerCase())),a=ae==="all"||t.primary_category===ae,n=ie==="all"||t.level===ie;return s&&a&&n}),dt=[...new Set(he.map(t=>t.level).filter(Boolean))],Se=t=>{const s=["#2196f3","#4caf50","#f44336","#ff9800"];return s[t%s.length]},ut=t=>t?Object.entries(t).map(([s,a])=>({year:s,subjects:a})):[],ht=t=>t?Object.entries(t).map(([s,a])=>({examType:s,details:a})):[],ke=()=>r.fee_breakdown?Object.values(r.fee_breakdown).reduce((t,s)=>{const a=parseFloat(s)||0;return t+a},0):0,te=t=>!r.entry_requirements||!r.entry_requirements[t]||!r.entry_requirements[t].required_subjects||!r.entry_requirements[t].required_subjects[0]?"":r.entry_requirements[t].required_subjects[0].min_grade||"",se=t=>!r.entry_requirements||!r.entry_requirements[t]||!r.entry_requirements[t].required_subjects||!r.entry_requirements[t].required_subjects[0]?"":r.entry_requirements[t].required_subjects[0].count||"";return e.jsx(gt,{title:"Course Management",description:"Manage all courses",children:e.jsxs(vt,{title:e.jsxs(c,{display:"flex",alignItems:"center",children:[e.jsx(i,{variant:"h4",children:"Courses"}),v&&v!=="admin"&&e.jsx(D,{title:`You have ${v} privileges`,children:e.jsx(M,{label:v.charAt(0).toUpperCase()+v.slice(1),size:"small",color:Lt(v),sx:{ml:2}})})]}),children:[e.jsxs(c,{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(p,{size:"small",placeholder:"Search courses...",value:J,onChange:t=>Ke(t.target.value),sx:{width:300},InputProps:{startAdornment:e.jsx(bt,{size:"20",style:{marginRight:"8px"}})}}),e.jsxs(P,{size:"small",sx:{minWidth:120},children:[e.jsx(T,{id:"category-filter-label",children:"Category"}),e.jsxs(U,{labelId:"category-filter-label",value:ae,label:"Category",onChange:t=>Qe(t.target.value),children:[e.jsx(x,{value:"all",children:"All Categories"}),me.map(t=>e.jsx(x,{value:t.name,children:t.name},t.id))]})]}),e.jsxs(P,{size:"small",sx:{minWidth:120},children:[e.jsx(T,{id:"level-filter-label",children:"Level"}),e.jsxs(U,{labelId:"level-filter-label",value:ie,label:"Level",onChange:t=>Ze(t.target.value),children:[e.jsx(x,{value:"all",children:"All Levels"}),dt.map(t=>e.jsx(x,{value:t,children:t},t))]})]})]}),e.jsxs(c,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(Be,{value:be,onChange:(t,s)=>Je(s),"aria-label":"view mode tabs",children:[e.jsx(N,{value:"table",icon:e.jsx(Mt,{size:"18"})}),e.jsx(N,{value:"grid",icon:e.jsx(Ft,{size:"18"})})]}),d.canCreate?e.jsx(b,{variant:"contained",color:"primary",startIcon:e.jsx(V,{size:"18"}),onClick:st,children:"Add Course"}):e.jsx(D,{title:"You don't have permission to add courses",children:e.jsx("span",{children:e.jsx(b,{variant:"contained",color:"primary",startIcon:e.jsx(V,{size:"18"}),disabled:!0,children:"Add Course"})})})]})]}),pe&&!je&&!ge?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:e.jsx(qe,{})}):xe?e.jsx(Ye,{severity:"error",children:xe}):e.jsx(e.Fragment,{children:be==="table"?e.jsx(yt,{component:Ct,sx:{boxShadow:"none"},children:e.jsxs(_t,{sx:{minWidth:650},"aria-label":"courses table",children:[e.jsx(St,{children:e.jsxs(oe,{children:[e.jsx(g,{children:"Course Name"}),e.jsx(g,{children:"University"}),e.jsx(g,{children:"Level"}),e.jsx(g,{children:"Duration"}),e.jsx(g,{children:"Fees"}),e.jsx(g,{children:"Category"}),e.jsx(g,{children:"Status"}),e.jsx(g,{children:"Actions"})]})}),e.jsx(kt,{children:ee.length>0?ee.map(t=>e.jsxs(oe,{children:[e.jsxs(g,{children:[e.jsx(i,{variant:"subtitle2",fontWeight:600,children:t.name}),t.description&&e.jsx(i,{variant:"body2",color:"textSecondary",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:t.description})]}),e.jsx(g,{children:t.university_name||"N/A"}),e.jsx(g,{children:e.jsx(M,{label:t.level||"N/A",size:"small",color:ue(t.level)})}),e.jsx(g,{children:t.duration||"N/A"}),e.jsx(g,{children:t.total_fee!==void 0&&t.total_fee!==null?`RM ${t.total_fee.toLocaleString()}`:"N/A"}),e.jsx(g,{children:t.primary_category||"N/A"}),e.jsx(g,{children:e.jsx(M,{label:t.status?t.status.replace("_"," ").toUpperCase():"DRAFT",size:"small",color:Z(t.status)})}),e.jsxs(g,{children:[e.jsx(f,{color:"info",size:"small",onClick:()=>fe(t),title:"View Details",children:e.jsx(Oe,{size:"18"})}),d.canUpdate?e.jsx(f,{color:"primary",size:"small",onClick:()=>ne(t),title:"Edit Course",children:e.jsx(re,{size:"18"})}):e.jsx(D,{title:"You don't have permission to edit",children:e.jsx("span",{children:e.jsx(f,{color:"primary",size:"small",disabled:!0,children:e.jsx(re,{size:"18"})})})}),d.canDelete?e.jsx(f,{color:"error",size:"small",onClick:()=>Ce(t.id),title:"Delete Course",children:e.jsx(H,{size:"18"})}):e.jsx(D,{title:"You don't have permission to delete",children:e.jsx("span",{children:e.jsx(f,{color:"error",size:"small",disabled:!0,children:e.jsx(H,{size:"18"})})})}),t.status==="pending_approval"&&d.canApprove&&e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Approve Course",children:e.jsx(f,{color:"success",size:"small",onClick:()=>q(t.id,"approved"),children:e.jsx(IconUserCheck,{size:"18"})})}),e.jsx(D,{title:"Reject Course",children:e.jsx(f,{color:"error",size:"small",onClick:()=>q(t.id,"rejected"),children:e.jsx(IconUserX,{size:"18"})})})]})]})]},t.id)):e.jsx(oe,{children:e.jsx(g,{colSpan:8,align:"center",children:e.jsx(i,{variant:"body2",color:"textSecondary",py:2,children:"No courses found."})})})})]})}):e.jsx(l,{container:!0,spacing:3,children:ee.length>0?ee.map((t,s)=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(S,{sx:{height:"100%",position:"relative"},children:[e.jsx(M,{label:t.status?t.status.replace("_"," ").toUpperCase():"DRAFT",size:"small",color:Z(t.status),sx:{position:"absolute",top:"10px",right:"10px",zIndex:1}}),e.jsxs(c,{sx:{position:"relative"},children:[e.jsx(c,{sx:{width:"100%",height:"140px",backgroundColor:Se(s),display:"flex",justifyContent:"center",alignItems:"center",color:"#ffffff",fontWeight:"bold"},children:t.primary_category||"Course"}),e.jsx(M,{label:t.level||"N/A",size:"small",color:ue(t.level),sx:{position:"absolute",top:"10px",left:"10px"}})]}),e.jsxs(I,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,noWrap:!0,children:t.name}),e.jsx(i,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:t.university_name||"Unknown University"}),e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1,children:[e.jsxs(i,{variant:"h6",children:["RM",(t.total_fee||0).toLocaleString()]}),e.jsx(i,{color:"textSecondary",variant:"caption",children:t.duration||"Unknown duration"})]}),e.jsxs(c,{mt:2,display:"flex",justifyContent:"space-between",children:[e.jsx(f,{size:"small",color:"info",onClick:()=>fe(t),children:e.jsx(Oe,{size:"16"})}),e.jsxs(c,{children:[d.canUpdate?e.jsx(f,{size:"small",color:"primary",onClick:()=>ne(t),children:e.jsx(re,{size:"16"})}):e.jsx(D,{title:"You don't have permission to edit",children:e.jsx("span",{children:e.jsx(f,{size:"small",color:"primary",disabled:!0,children:e.jsx(re,{size:"16"})})})}),d.canDelete?e.jsx(f,{size:"small",color:"error",onClick:()=>Ce(t.id),children:e.jsx(H,{size:"16"})}):e.jsx(D,{title:"You don't have permission to delete",children:e.jsx("span",{children:e.jsx(f,{size:"small",color:"error",disabled:!0,children:e.jsx(H,{size:"16"})})})})]})]})]})]})},t.id)):e.jsx(l,{item:!0,xs:12,children:e.jsx(i,{align:"center",color:"textSecondary",children:"No courses available to display."})})})}),e.jsx(Pe,{open:ge,onClose:()=>E(!1),fullWidth:!0,maxWidth:"md",children:o&&e.jsxs(e.Fragment,{children:[e.jsxs(Te,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(c,{display:"flex",alignItems:"center",children:[e.jsx(i,{variant:"h6",children:"Course Details"}),e.jsx(M,{label:o.status?o.status.replace("_"," ").toUpperCase():"DRAFT",size:"small",color:Z(o.status),sx:{ml:2}})]}),e.jsx(f,{onClick:()=>E(!1),children:e.jsx(Rt,{size:"18"})})]}),e.jsxs(Ue,{children:[e.jsxs(c,{sx:{mb:3},children:[e.jsx(c,{sx:{height:"100px",backgroundColor:Se(1),display:"flex",justifyContent:"center",alignItems:"center",borderRadius:1,mb:2},children:e.jsx(i,{variant:"h4",color:"white",children:o.primary_category||"Course"})}),e.jsx(i,{variant:"h5",fontWeight:600,children:o.name}),e.jsx(i,{variant:"subtitle1",color:"primary",fontWeight:500,children:o.university_name||"Unknown University"}),e.jsx(M,{label:o.level||"N/A",size:"small",color:ue(o.level),sx:{mt:1}})]}),e.jsx(wt,{sx:{my:2}}),e.jsxs(l,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(l,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(It,{size:"20",style:{marginRight:"8px",color:"#1976d2"}}),e.jsx(i,{variant:"body2",fontWeight:500,children:"Intakes"})]}),e.jsx(i,{variant:"body1",sx:{mt:1,pl:3.5},children:o.intakes&&o.intakes.length>0?o.intakes.join(", "):"No intake information"})]}),e.jsxs(l,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(At,{size:"20",style:{marginRight:"8px",color:"#1976d2"}}),e.jsx(i,{variant:"body2",fontWeight:500,children:"Duration"})]}),e.jsx(i,{variant:"body1",sx:{mt:1,pl:3.5},children:o.duration||"Not specified"})]}),e.jsxs(l,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Dt,{size:"20",style:{marginRight:"8px",color:"#1976d2"}}),e.jsx(i,{variant:"body2",fontWeight:500,children:"Total Fee"})]}),e.jsx(i,{variant:"body1",sx:{mt:1,pl:3.5},children:o.total_fee!==void 0&&o.total_fee!==null?`RM ${o.total_fee.toLocaleString()}`:"Not specified"})]}),e.jsxs(l,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(zt,{size:"20",style:{marginRight:"8px",color:"#1976d2"}}),e.jsx(i,{variant:"body2",fontWeight:500,children:"Category"})]}),e.jsx(i,{variant:"body1",sx:{mt:1,pl:3.5},children:o.primary_category||"Not categorized"})]})]}),o.description&&e.jsxs(c,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",sx:{mb:1},children:"Description"}),e.jsx(i,{variant:"body1",children:o.description})]}),o.subjects&&Object.keys(o.subjects).length>0&&e.jsxs(c,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",sx:{mb:1},children:"Subjects"}),e.jsx(l,{container:!0,spacing:2,children:ut(o.subjects).map((t,s)=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(S,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,sx:{mb:1},children:t.year}),e.jsx($e,{dense:!0,disablePadding:!0,children:t.subjects.map((a,n)=>e.jsx(ce,{disablePadding:!0,sx:{py:.5},children:e.jsx(de,{primary:a,primaryTypographyProps:{variant:"body2"}})},n))})]})})},s))})]}),o.entry_requirements&&Object.keys(o.entry_requirements).length>0&&e.jsxs(c,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",sx:{mb:1},children:"Entry Requirements"}),e.jsx(l,{container:!0,spacing:2,children:ht(o.entry_requirements).map((t,s)=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,sx:{mb:1},children:t.examType}),t.details.min_cgpa&&e.jsxs(i,{variant:"body2",children:["Minimum CGPA: ",t.details.min_cgpa]}),t.details.required_subjects&&e.jsxs(c,{sx:{mt:1},children:[e.jsx(i,{variant:"body2",sx:{mb:.5},children:"Required Subjects:"}),t.details.required_subjects.map((a,n)=>e.jsxs(i,{variant:"body2",sx:{pl:2},children:["• ",a.count," subject(s) with minimum grade ",a.min_grade]},n))]})]})})},s))})]}),o.fee_breakdown&&Object.keys(o.fee_breakdown).length>0&&e.jsxs(c,{sx:{mb:3},children:[e.jsx(i,{variant:"h6",sx:{mb:1},children:"Fee Breakdown"}),e.jsx(S,{variant:"outlined",children:e.jsxs($e,{children:[Object.entries(o.fee_breakdown).map(([t,s],a)=>e.jsx(ce,{divider:a<Object.keys(o.fee_breakdown).length-1,children:e.jsx(de,{primary:t.charAt(0).toUpperCase()+t.slice(1),secondary:`RM ${parseFloat(s).toLocaleString()}`})},a)),e.jsx(ce,{sx:{bgcolor:"rgba(25, 118, 210, 0.08)"},children:e.jsx(de,{primary:"Total",secondary:`RM ${o.total_fee?o.total_fee.toLocaleString():0}`,primaryTypographyProps:{fontWeight:"bold"},secondaryTypographyProps:{fontWeight:"bold"}})})]})})]})]}),e.jsxs(Ne,{children:[e.jsx(b,{onClick:()=>E(!1),children:"Close"}),d.canUpdate&&e.jsx(b,{variant:"contained",color:"primary",onClick:()=>{E(!1),ne(o)},children:"Edit Course"}),o.status==="pending_approval"&&d.canApprove&&e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"contained",color:"success",onClick:()=>q(o.id,"approved"),children:"Approve"}),e.jsx(b,{variant:"contained",color:"error",onClick:()=>q(o.id,"rejected"),children:"Reject"})]})]})]})}),e.jsxs(Pe,{open:je,onClose:()=>Y(!1),fullWidth:!0,maxWidth:"md",scroll:"paper",children:[e.jsx(Te,{children:e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(i,{variant:"h6",children:k==="add"?"Add New Course":"Edit Course"}),k==="edit"&&r.status&&e.jsx(M,{label:r.status.replace("_"," ").toUpperCase(),size:"small",color:Z(r.status)})]})}),e.jsx(Ue,{dividers:!0,children:e.jsxs(c,{component:"form",sx:{mt:1},children:[e.jsxs(Be,{value:$,onChange:(t,s)=>et(s),variant:"scrollable",scrollButtons:"auto",sx:{mb:3,borderBottom:1,borderColor:"divider"},children:[e.jsx(N,{label:"Basic Information"}),e.jsx(N,{label:"Subjects"}),e.jsx(N,{label:"Fees"}),e.jsx(N,{label:"Entry Requirements"})]}),$===0&&e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:12,sm:8,children:e.jsx(p,{fullWidth:!0,label:"Course Name",name:"name",value:r.name,onChange:F,required:!0})}),e.jsx(l,{item:!0,xs:12,sm:4,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(T,{id:"level-select-label",children:"Level"}),e.jsxs(U,{labelId:"level-select-label",name:"level",value:r.level,label:"Level",onChange:F,children:[e.jsx(x,{value:"",children:"Select Level"}),e.jsx(x,{value:"Foundation",children:"Foundation"}),e.jsx(x,{value:"Diploma",children:"Diploma"}),e.jsx(x,{value:"Degree",children:"Degree"}),e.jsx(x,{value:"Masters",children:"Masters"}),e.jsx(x,{value:"PhD",children:"PhD"})]})]})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(p,{fullWidth:!0,label:"Description",name:"description",value:r.description,onChange:F,multiline:!0,rows:3})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(T,{id:"university-select-label",children:"University"}),e.jsxs(U,{labelId:"university-select-label",name:"university_id",value:r.university_id,label:"University",onChange:F,children:[e.jsx(x,{value:"",children:"Select University"}),Ge.map(t=>e.jsx(x,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(T,{id:"category-select-label",children:"Category"}),e.jsxs(U,{labelId:"category-select-label",name:"primary_category",value:r.primary_category,label:"Category",onChange:F,children:[e.jsx(x,{value:"",children:"Select Category"}),me.map(t=>e.jsx(x,{value:t.name,children:t.name},t.id))]})]})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(p,{fullWidth:!0,label:"Duration",name:"duration",value:r.duration,onChange:F,placeholder:"e.g. 3 years, 2 semesters"})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(p,{fullWidth:!0,label:"Intake Months (comma separated)",name:"intakes",value:((we=r.intakes)==null?void 0:we.join(", "))||"",onChange:it,placeholder:"e.g. Jan, Mar, Sep",helperText:"Enter month names separated by commas"})}),k==="edit"&&e.jsx(l,{item:!0,xs:12,children:e.jsxs(P,{fullWidth:!0,children:[e.jsx(T,{id:"status-select-label",children:"Status"}),e.jsxs(U,{labelId:"status-select-label",name:"status",value:r.status||"draft",label:"Status",onChange:t=>rt(t.target.value),disabled:!d.canApprove&&r.status!=="draft",children:[e.jsx(x,{value:"draft",children:"Draft"}),e.jsx(x,{value:"pending_approval",children:"Pending Approval"}),d.canApprove&&e.jsxs(e.Fragment,{children:[e.jsx(x,{value:"approved",children:"Approved"}),e.jsx(x,{value:"rejected",children:"Rejected"})]})]}),!d.canApprove&&r.status!=="draft"&&e.jsx(i,{variant:"caption",color:"textSecondary",children:"You need moderator or admin permissions to change the status of this course."})]})})]}),$===1&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(i,{variant:"subtitle1",children:"Course Subjects"}),e.jsx(b,{size:"small",startIcon:e.jsx(V,{size:16}),onClick:ye,children:"Add Year"})]}),r.subjects&&Object.keys(r.subjects).length>0?Object.entries(r.subjects).map(([t,s])=>e.jsx(S,{variant:"outlined",sx:{mb:3},children:e.jsxs(I,{children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(i,{variant:"subtitle1",children:t}),e.jsx(b,{size:"small",startIcon:e.jsx(V,{size:16}),onClick:()=>lt(t),children:"Add Subject"})]}),s.map((a,n)=>e.jsxs(c,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(p,{fullWidth:!0,size:"small",label:`Subject ${n+1}`,value:a,onChange:u=>nt(t,n,u.target.value)}),e.jsx(f,{color:"error",onClick:()=>ot(t,n),sx:{ml:1},children:e.jsx(H,{size:18})})]},n))]})},t)):e.jsxs(c,{textAlign:"center",py:4,children:[e.jsx(i,{color:"textSecondary",mb:2,children:"No subjects added yet"}),e.jsx(b,{variant:"outlined",startIcon:e.jsx(V,{size:18}),onClick:ye,children:"Add Year 1"})]})]}),$===2&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Total Fee"}),e.jsx(p,{fullWidth:!0,label:"Total Fee (RM)",name:"total_fee",value:r.total_fee,onChange:F,type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:"RM"})},sx:{mb:3}}),e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Fee Breakdown"}),e.jsx(i,{variant:"body2",color:"textSecondary",mb:2,children:"Specify individual fee components (the sum should match the total fee)"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(p,{fullWidth:!0,label:"Registration Fee",value:((Ie=r.fee_breakdown)==null?void 0:Ie.registration)||"",onChange:t=>Q("registration",t.target.value),type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:"RM"})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(p,{fullWidth:!0,label:"Tuition Fee",value:((ze=r.fee_breakdown)==null?void 0:ze.tuition)||"",onChange:t=>Q("tuition",t.target.value),type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:"RM"})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(p,{fullWidth:!0,label:"Resource Fee",value:((Ae=r.fee_breakdown)==null?void 0:Ae.resources)||"",onChange:t=>Q("resources",t.target.value),type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:"RM"})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(p,{fullWidth:!0,label:"Other Fees",value:((De=r.fee_breakdown)==null?void 0:De.other)||"",onChange:t=>Q("other",t.target.value),type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:"RM"})}})})]}),e.jsxs(c,{mt:3,p:2,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1,children:[e.jsx(i,{variant:"subtitle2",children:"Fee Calculation"}),e.jsxs(c,{display:"flex",justifyContent:"space-between",mt:1,children:[e.jsx(i,{children:"Total Fee Components:"}),e.jsxs(i,{fontWeight:"bold",children:["RM ",ke()]})]}),e.jsxs(c,{display:"flex",justifyContent:"space-between",mt:1,children:[e.jsx(i,{children:"Main Total Fee:"}),e.jsxs(i,{fontWeight:"bold",children:["RM ",r.total_fee?r.total_fee.toLocaleString():0]})]}),r.total_fee!==ke()&&e.jsx(i,{color:"error",variant:"caption",mt:1,children:"Note: The sum of fee components doesn't match the total fee"})]})]}),$===3&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Entry Requirements"}),e.jsx(i,{variant:"body2",color:"textSecondary",mb:2,children:"Specify the entry requirements for different education backgrounds"}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",mb:2,children:"A-Levels"}),e.jsxs(c,{mb:2,children:[e.jsx(i,{variant:"body2",mb:1,children:"Required Subjects:"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(p,{fullWidth:!0,size:"small",label:"Minimum Grade",value:te("A-Levels"),onChange:t=>R("A-Levels","required_subjects",{grade:t.target.value,count:se("A-Levels")}),placeholder:"e.g. C"})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(p,{fullWidth:!0,size:"small",label:"Number of Subjects",type:"number",value:se("A-Levels"),onChange:t=>R("A-Levels","required_subjects",{grade:te("A-Levels"),count:t.target.value}),placeholder:"e.g. 2"})})]})]})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",mb:2,children:"STPM"}),e.jsx(p,{fullWidth:!0,size:"small",label:"Minimum CGPA",type:"number",value:((Fe=(Me=r.entry_requirements)==null?void 0:Me.STPM)==null?void 0:Fe.min_cgpa)||"",onChange:t=>R("STPM","min_cgpa",t.target.value),placeholder:"e.g. 2.33",InputProps:{inputProps:{min:0,max:4,step:.01}}})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",mb:2,children:"UEC"}),e.jsxs(c,{mb:2,children:[e.jsx(i,{variant:"body2",mb:1,children:"Required Subjects:"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(p,{fullWidth:!0,size:"small",label:"Minimum Grade",value:te("UEC"),onChange:t=>R("UEC","required_subjects",{grade:t.target.value,count:se("UEC")}),placeholder:"e.g. B"})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(p,{fullWidth:!0,size:"small",label:"Number of Subjects",type:"number",value:se("UEC"),onChange:t=>R("UEC","required_subjects",{grade:te("UEC"),count:t.target.value}),placeholder:"e.g. 5"})})]})]})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",mb:2,children:"Diploma"}),e.jsx(p,{fullWidth:!0,size:"small",label:"Minimum CGPA",type:"number",value:((Le=(Re=r.entry_requirements)==null?void 0:Re.Diploma)==null?void 0:Le.min_cgpa)||"",onChange:t=>R("Diploma","min_cgpa",t.target.value),placeholder:"e.g. 2.5",InputProps:{inputProps:{min:0,max:4,step:.01}}})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{variant:"outlined",children:e.jsxs(I,{children:[e.jsx(i,{variant:"subtitle1",mb:2,children:"Foundation"}),e.jsx(p,{fullWidth:!0,size:"small",label:"Minimum CGPA",type:"number",value:((Ee=(We=r.entry_requirements)==null?void 0:We.Foundation)==null?void 0:Ee.min_cgpa)||"",onChange:t=>R("Foundation","min_cgpa",t.target.value),placeholder:"e.g. 2.5",InputProps:{inputProps:{min:0,max:4,step:.01}}})]})})})]})]})]})}),e.jsxs(Ne,{children:[e.jsx(b,{onClick:()=>Y(!1),children:"Cancel"}),k==="edit"&&r.status==="draft"&&(v==="editor"||v==="admin")&&e.jsx(b,{variant:"outlined",color:"warning",onClick:at,children:"Submit for Approval"}),k==="edit"&&r.status==="pending_approval"&&d.canApprove&&e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"outlined",color:"success",onClick:()=>q(r.id,"approved"),children:"Approve"}),e.jsx(b,{variant:"outlined",color:"error",onClick:()=>q(r.id,"rejected"),children:"Reject"})]}),e.jsx(b,{onClick:ct,variant:"contained",color:"primary",disabled:!r.name,children:pe?e.jsx(qe,{size:24}):"Save"})]})]}),e.jsx(ft,{open:K.open,autoHideDuration:6e3,onClose:_e,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Ye,{onClose:_e,severity:K.severity,variant:"filled",children:K.message})})]})})};export{us as default};
